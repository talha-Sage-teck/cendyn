import { ChangeDetectorRef, Component, ElementRef, Input, KeyValueDiffers, Renderer2 } from '@angular/core';
import { SvgIconRegistryService } from './svg-icon-registry.service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './svg-icon-registry.service';

const _c0 = ["*"];
class SvgIconHelper {
    constructor() {
        this.loaded = false;
    }
}
export class SvgIconComponent {
    constructor(element, differs, renderer, iconReg, cdr) {
        this.element = element;
        this.differs = differs;
        this.renderer = renderer;
        this.iconReg = iconReg;
        this.cdr = cdr;
        this.stretch = false;
        this.applyClass = false;
        /** @deprecated since 9.1.0 */
        this.applyCss = false;
        this.helper = new SvgIconHelper();
        this._svgStyle = null;
    }
    // Adapted from ngStyle (see:  angular/packages/common/src/directives/ng_style.ts)
    set svgStyle(values) {
        this._svgStyle = values;
        if (!this.helper.differ && values) {
            this.helper.differ = this.differs.find(values).create();
        }
    }
    ngOnInit() {
        this.init();
    }
    ngOnDestroy() {
        this.destroy();
    }
    ngOnChanges(changeRecord) {
        const elemSvg = this.element.nativeElement.firstChild;
        if (changeRecord.src || changeRecord.name) {
            if (this.helper.loaded) {
                this.destroy();
            }
            this.init();
        }
        if (changeRecord.stretch) {
            this.stylize();
        }
        if (changeRecord.applyClass) {
            if (this.applyClass) {
                this.setClass(elemSvg, null, this.klass);
            }
            else {
                this.setClass(elemSvg, this.klass, null);
            }
        }
        if (changeRecord.svgClass) {
            this.setClass(elemSvg, changeRecord.svgClass.previousValue, changeRecord.svgClass.currentValue);
        }
        if (changeRecord.klass) {
            const elem = this.element.nativeElement;
            this.setClass(elem, changeRecord.klass.previousValue, changeRecord.klass.currentValue);
            if (this.applyClass) {
                this.setClass(elemSvg, changeRecord.klass.previousValue, changeRecord.klass.currentValue);
            }
            else {
                this.setClass(elemSvg, changeRecord.klass.previousValue, null);
            }
        }
        if (changeRecord.viewBox) {
            if (this.helper.loaded) {
                this.destroy();
            }
            this.init();
        }
        if (changeRecord.applyCss) {
            console.warn('applyCss deprecated since 9.1.0, will be removed in 10.0.0');
            console.warn('use applyClass instead');
        }
        if (changeRecord.svgAriaLabel) {
            this.doAria(changeRecord.svgAriaLabel.currentValue);
        }
    }
    ngDoCheck() {
        if (this.helper.svg && this.helper.differ) {
            const changes = this.helper.differ.diff(this._svgStyle);
            if (changes) {
                this.applyChanges(changes);
            }
        }
    }
    init() {
        if (this.name) {
            const svgObs = this.iconReg.getSvgByName(this.name);
            if (svgObs) {
                this.helper.icnSub = svgObs.subscribe(svg => this.initSvg(svg));
            }
        }
        else if (this.src) {
            const svgObs = this.iconReg.loadSvg(this.src);
            if (svgObs) {
                this.helper.icnSub = svgObs.subscribe(svg => this.initSvg(svg));
            }
        }
        else {
            const elem = this.element.nativeElement;
            elem.innerHTML = '';
            this.cdr.markForCheck();
        }
    }
    initSvg(svg) {
        if (!this.helper.loaded && svg) {
            this.setSvg(svg);
            this.resetDiffer();
        }
    }
    destroy() {
        if (this.helper.icnSub) {
            this.helper.icnSub.unsubscribe();
        }
        this.helper = new SvgIconHelper();
    }
    resetDiffer() {
        if (this._svgStyle && !this.helper.differ) {
            this.helper.differ = this.differs.find(this._svgStyle).create();
        }
    }
    setSvg(svg) {
        if (!this.helper.loaded && svg) {
            this.helper.svg = svg;
            const icon = svg.cloneNode(true);
            const elem = this.element.nativeElement;
            elem.innerHTML = '';
            this.renderer.appendChild(elem, icon);
            this.helper.loaded = true;
            this.copyNgContentAttribute(elem, icon);
            if (this.klass && this.applyClass) {
                this.setClass(elem.firstChild, null, this.klass);
            }
            if (this.svgClass) {
                this.setClass(elem.firstChild, null, this.svgClass);
            }
            if (this.viewBox) {
                if (this.viewBox === 'auto') {
                    // Attempt to convert height & width to a viewBox.
                    const w = icon.getAttribute('width');
                    const h = icon.getAttribute('height');
                    if (h && w) {
                        const vb = `0 0 ${w} ${h}`;
                        this.renderer.setAttribute(icon, 'viewBox', vb);
                        this.renderer.removeAttribute(icon, 'width');
                        this.renderer.removeAttribute(icon, 'height');
                    }
                }
                else if (this.viewBox !== '') {
                    this.renderer.setAttribute(icon, 'viewBox', this.viewBox);
                    this.renderer.removeAttribute(icon, 'width');
                    this.renderer.removeAttribute(icon, 'height');
                }
            }
            this.stylize();
            // If there is not a svgAriaLabel and the SVG has an arial-label, then do not override
            // the SVG's aria-label.
            if (!(this.svgAriaLabel === undefined && elem.firstChild.hasAttribute('aria-label'))) {
                this.doAria(this.svgAriaLabel || '');
            }
            this.cdr.markForCheck();
        }
    }
    copyNgContentAttribute(hostElem, icon) {
        const attributes = hostElem.attributes;
        const len = attributes.length;
        for (let i = 0; i < len; i += 1) {
            const attribute = attributes.item(i);
            if (attribute && attribute.name.startsWith('_ngcontent')) {
                this.setNgContentAttribute(icon, attribute.name);
                break;
            }
        }
    }
    setNgContentAttribute(parent, attributeName) {
        this.renderer.setAttribute(parent, attributeName, '');
        const len = parent.childNodes.length;
        for (let i = 0; i < len; i += 1) {
            const child = parent.childNodes[i];
            if (child instanceof Element) {
                this.setNgContentAttribute(child, attributeName);
            }
        }
    }
    stylize() {
        if (this.helper.svg) {
            const svg = this.element.nativeElement.firstChild;
            if (this.stretch === true) {
                this.renderer.setAttribute(svg, 'preserveAspectRatio', 'none');
            }
            else if (this.stretch === false) {
                this.renderer.removeAttribute(svg, 'preserveAspectRatio');
            }
        }
    }
    applyChanges(changes) {
        changes.forEachRemovedItem((record) => this.setStyle(record.key, null));
        changes.forEachAddedItem((record) => this.setStyle(record.key, record.currentValue));
        changes.forEachChangedItem((record) => this.setStyle(record.key, record.currentValue));
    }
    setStyle(nameAndUnit, value) {
        const [name, unit] = nameAndUnit.split('.');
        value = value !== null && unit ? `${value}${unit}` : value;
        const svg = this.element.nativeElement.firstChild;
        if (value !== null) {
            this.renderer.setStyle(svg, name, value);
        }
        else {
            this.renderer.removeStyle(svg, name);
        }
    }
    setClass(target, previous, current) {
        if (target) {
            if (previous) {
                const klasses = Array.isArray(previous) ? previous : previous.split(' ');
                for (const k of klasses) {
                    this.renderer.removeClass(target, k);
                }
            }
            if (current) {
                const klasses = Array.isArray(current) ? current : current.split(' ');
                for (const k of klasses) {
                    this.renderer.addClass(target, k);
                }
            }
        }
    }
    doAria(label) {
        const svg = this.element.nativeElement.firstChild;
        if (svg) {
            if (label === '') {
                this.renderer.setAttribute(svg, 'aria-hidden', 'true');
                this.renderer.removeAttribute(svg, 'aria-label');
            }
            else {
                this.renderer.removeAttribute(svg, 'aria-hidden');
                this.renderer.setAttribute(svg, 'aria-label', label);
            }
        }
    }
}
SvgIconComponent.ɵfac = function SvgIconComponent_Factory(t) { return new (t || SvgIconComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.KeyValueDiffers), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.SvgIconRegistryService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef)); };
SvgIconComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: SvgIconComponent, selectors: [["svg-icon"]], inputs: { stretch: "stretch", applyClass: "applyClass", applyCss: "applyCss", svgStyle: "svgStyle", src: "src", name: "name", svgClass: "svgClass", klass: ["class", "klass"], viewBox: "viewBox", svgAriaLabel: "svgAriaLabel" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], ngContentSelectors: _c0, decls: 1, vars: 0, template: function SvgIconComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef();
        ɵngcc0.ɵɵprojection(0);
    } }, encapsulation: 2 });
SvgIconComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: KeyValueDiffers },
    { type: Renderer2 },
    { type: SvgIconRegistryService },
    { type: ChangeDetectorRef }
];
SvgIconComponent.propDecorators = {
    src: [{ type: Input }],
    name: [{ type: Input }],
    stretch: [{ type: Input }],
    applyClass: [{ type: Input }],
    applyCss: [{ type: Input }],
    svgClass: [{ type: Input }],
    klass: [{ type: Input, args: ['class',] }],
    viewBox: [{ type: Input }],
    svgAriaLabel: [{ type: Input }],
    svgStyle: [{ type: Input }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(SvgIconComponent, [{
        type: Component,
        args: [{
                selector: 'svg-icon',
                template: '<ng-content></ng-content>'
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.KeyValueDiffers }, { type: ɵngcc0.Renderer2 }, { type: ɵngcc1.SvgIconRegistryService }, { type: ɵngcc0.ChangeDetectorRef }]; }, { stretch: [{
            type: Input
        }], applyClass: [{
            type: Input
        }], applyCss: [{
            type: Input
        }], svgStyle: [{
            type: Input
        }], src: [{
            type: Input
        }], name: [{
            type: Input
        }], svgClass: [{
            type: Input
        }], klass: [{
            type: Input,
            args: ['class']
        }], viewBox: [{
            type: Input
        }], svgAriaLabel: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3ZnLWljb24uY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9hbmd1bGFyLXN2Zy1pY29uL3NyYy9saWIvc3ZnLWljb24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQVcsVUFBVSxFQUFFLEtBQUssRUFDVCxlQUFlLEVBQ3hDLFNBQVMsRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFJL0UsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7Ozs7O0FBR3JFLE1BQU0sYUFBYTtBQUNuQixJQURBO0FBQWdCLFFBSWYsV0FBTSxHQUFHLEtBQUssQ0FBQztBQUNoQixJQUFBLENBQUM7QUFDRCxDQURDO0FBTUQsTUFBTSxPQUFPLGdCQUFnQjtBQUFHLElBeUIvQixZQUNTLE9BQW1CLEVBQ25CLE9BQXdCLEVBQ3hCLFFBQW1CLEVBQ25CLE9BQStCLEVBQy9CLEdBQXNCO0FBQ2hDLFFBTFUsWUFBTyxHQUFQLE9BQU8sQ0FBWTtBQUFDLFFBQ3BCLFlBQU8sR0FBUCxPQUFPLENBQWlCO0FBQUMsUUFDekIsYUFBUSxHQUFSLFFBQVEsQ0FBVztBQUFDLFFBQ3BCLFlBQU8sR0FBUCxPQUFPLENBQXdCO0FBQUMsUUFDaEMsUUFBRyxHQUFILEdBQUcsQ0FBbUI7QUFBQyxRQTNCdkIsWUFBTyxHQUFHLEtBQUssQ0FBQztBQUMxQixRQUFVLGVBQVUsR0FBRyxLQUFLLENBQUM7QUFDN0IsUUFBQyw4QkFBOEI7QUFDL0IsUUFBVSxhQUFRLEdBQUcsS0FBSyxDQUFDO0FBQzNCLFFBZVMsV0FBTSxHQUFHLElBQUksYUFBYSxFQUFFLENBQUM7QUFDdEMsUUFBUyxjQUFTLEdBQWdDLElBQUksQ0FBQztBQUN2RCxJQU9DLENBQUM7QUFDRixJQW5CQyxrRkFBa0Y7QUFDbkYsSUFBQyxJQUNJLFFBQVEsQ0FBQyxNQUFvQztBQUNsRCxRQUFFLElBQUksQ0FBQyxT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SyxDQUFDLENBQUM7QUFDekQsYUFBSTtBQUNKLFNBQUc7QUFDSCxJQUFDLENBQUM7QUFDRjs0Q0FwUkMsU0FBUyxTQUFDLGtCQUNWLFFBQVEsRUFBRSxVQUFVLGtCQUNwQixRQUFRLEVBQUUsMkJBQTJCLGNBQ3JDOzs7OzZCQUNJO0FBQUM7QUFBMEMsWUFwQkEsVUFBVTtBQUFJLFlBQ04sZUFBZTtBQUNyRSxZQUE2QixTQUFTO0FBQUksWUFJbkMsc0JBQXNCO0FBQUksWUFOMUIsaUJBQWlCO0FBQUc7QUFBRztBQUMvQixrQkFvQkMsS0FBSztBQUFLLG1CQUNWLEtBQUs7QUFBSyxzQkFDVixLQUFLO0FBQUsseUJBQ1YsS0FBSztBQUFLLHVCQUVWLEtBQUs7QUFBSyx1QkFDVixLQUFLO0FBQUssb0JBRVYsS0FBSyxTQUFDLE9BQU87QUFBTyxzQkFDcEIsS0FBSztBQUFLLDJCQUNWLEtBQUs7QUFBSyx1QkFHVixLQUFLO0FBQ047Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbIlxuaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgRG9DaGVjaywgRWxlbWVudFJlZiwgSW5wdXQsXG5cdEtleVZhbHVlQ2hhbmdlUmVjb3JkLCBLZXlWYWx1ZUNoYW5nZXMsIEtleVZhbHVlRGlmZmVyLCBLZXlWYWx1ZURpZmZlcnMsXG5cdE9uQ2hhbmdlcywgT25EZXN0cm95LCBPbkluaXQsIFJlbmRlcmVyMiwgU2ltcGxlQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgU3ZnSWNvblJlZ2lzdHJ5U2VydmljZSB9IGZyb20gJy4vc3ZnLWljb24tcmVnaXN0cnkuc2VydmljZSc7XG5cblxuY2xhc3MgU3ZnSWNvbkhlbHBlciB7XG5cdHN2ZyE6IFNWR0VsZW1lbnQ7XG5cdGljblN1YiE6IFN1YnNjcmlwdGlvbjtcblx0ZGlmZmVyPzogS2V5VmFsdWVEaWZmZXI8c3RyaW5nLCBzdHJpbmd8bnVtYmVyPjtcblx0bG9hZGVkID0gZmFsc2U7XG59XG5cbkBDb21wb25lbnQoe1xuXHRzZWxlY3RvcjogJ3N2Zy1pY29uJyxcblx0dGVtcGxhdGU6ICc8bmctY29udGVudD48L25nLWNvbnRlbnQ+J1xufSlcbmV4cG9ydCBjbGFzcyBTdmdJY29uQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlcywgRG9DaGVjayB7XG5cdEBJbnB1dCgpIHNyYyE6IHN0cmluZztcblx0QElucHV0KCkgbmFtZT86IHN0cmluZztcblx0QElucHV0KCkgc3RyZXRjaCA9IGZhbHNlO1xuXHRASW5wdXQoKSBhcHBseUNsYXNzID0gZmFsc2U7XG5cdC8qKiBAZGVwcmVjYXRlZCBzaW5jZSA5LjEuMCAqL1xuXHRASW5wdXQoKSBhcHBseUNzcyA9IGZhbHNlO1xuXHRASW5wdXQoKSBzdmdDbGFzcz86IGFueTtcblx0Ly8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWlucHV0LXJlbmFtZVxuXHRASW5wdXQoJ2NsYXNzJykga2xhc3M/OiBhbnk7XG5cdEBJbnB1dCgpIHZpZXdCb3g/OiBzdHJpbmc7XG5cdEBJbnB1dCgpIHN2Z0FyaWFMYWJlbD86IHN0cmluZztcblxuXHQvLyBBZGFwdGVkIGZyb20gbmdTdHlsZSAoc2VlOiAgYW5ndWxhci9wYWNrYWdlcy9jb21tb24vc3JjL2RpcmVjdGl2ZXMvbmdfc3R5bGUudHMpXG5cdEBJbnB1dCgpXG5cdHNldCBzdmdTdHlsZSh2YWx1ZXM6IHtba2xhc3M6IHN0cmluZ106IGFueSB9fG51bGwpIHtcblx0XHR0aGlzLl9zdmdTdHlsZSA9IHZhbHVlcztcblx0XHRpZiAoIXRoaXMuaGVscGVyLmRpZmZlciAmJiB2YWx1ZXMpIHtcblx0XHRcdHRoaXMuaGVscGVyLmRpZmZlciA9IHRoaXMuZGlmZmVycy5maW5kKHZhbHVlcykuY3JlYXRlKCk7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBoZWxwZXIgPSBuZXcgU3ZnSWNvbkhlbHBlcigpO1xuXHRwcml2YXRlIF9zdmdTdHlsZToge1trZXk6IHN0cmluZ106IGFueX0gfCBudWxsID0gbnVsbDtcblxuXHRjb25zdHJ1Y3Rvcihcblx0XHRwcml2YXRlIGVsZW1lbnQ6IEVsZW1lbnRSZWYsXG5cdFx0cHJpdmF0ZSBkaWZmZXJzOiBLZXlWYWx1ZURpZmZlcnMsXG5cdFx0cHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxuXHRcdHByaXZhdGUgaWNvblJlZzogU3ZnSWNvblJlZ2lzdHJ5U2VydmljZSxcblx0XHRwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcblx0fVxuXG5cdG5nT25Jbml0KCkge1xuXHRcdHRoaXMuaW5pdCgpO1xuXHR9XG5cblx0bmdPbkRlc3Ryb3koKSB7XG5cdFx0dGhpcy5kZXN0cm95KCk7XG5cdH1cblxuXHRuZ09uQ2hhbmdlcyhjaGFuZ2VSZWNvcmQ6IFNpbXBsZUNoYW5nZXMpIHtcblx0XHRjb25zdCBlbGVtU3ZnID0gdGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZmlyc3RDaGlsZDtcblxuXHRcdGlmIChjaGFuZ2VSZWNvcmQuc3JjIHx8IGNoYW5nZVJlY29yZC5uYW1lKSB7XG5cdFx0XHRpZiAodGhpcy5oZWxwZXIubG9hZGVkKSB7XG5cdFx0XHRcdHRoaXMuZGVzdHJveSgpO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy5pbml0KCk7XG5cdFx0fVxuXHRcdGlmIChjaGFuZ2VSZWNvcmQuc3RyZXRjaCkge1xuXHRcdFx0dGhpcy5zdHlsaXplKCk7XG5cdFx0fVxuXG5cdFx0aWYgKGNoYW5nZVJlY29yZC5hcHBseUNsYXNzKSB7XG5cdFx0XHRpZiAodGhpcy5hcHBseUNsYXNzKSB7XG5cdFx0XHRcdHRoaXMuc2V0Q2xhc3MoZWxlbVN2ZywgbnVsbCwgdGhpcy5rbGFzcyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLnNldENsYXNzKGVsZW1TdmcsIHRoaXMua2xhc3MsIG51bGwpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChjaGFuZ2VSZWNvcmQuc3ZnQ2xhc3MpIHtcblx0XHRcdHRoaXMuc2V0Q2xhc3MoZWxlbVN2ZywgY2hhbmdlUmVjb3JkLnN2Z0NsYXNzLnByZXZpb3VzVmFsdWUsIGNoYW5nZVJlY29yZC5zdmdDbGFzcy5jdXJyZW50VmFsdWUpO1xuXHRcdH1cblxuXHRcdGlmIChjaGFuZ2VSZWNvcmQua2xhc3MpIHtcblx0XHRcdGNvbnN0IGVsZW0gPSB0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudDtcblx0XHRcdHRoaXMuc2V0Q2xhc3MoZWxlbSwgY2hhbmdlUmVjb3JkLmtsYXNzLnByZXZpb3VzVmFsdWUsIGNoYW5nZVJlY29yZC5rbGFzcy5jdXJyZW50VmFsdWUpO1xuXG5cdFx0XHRpZiAodGhpcy5hcHBseUNsYXNzKSB7XG5cdFx0XHRcdHRoaXMuc2V0Q2xhc3MoZWxlbVN2ZywgY2hhbmdlUmVjb3JkLmtsYXNzLnByZXZpb3VzVmFsdWUsIGNoYW5nZVJlY29yZC5rbGFzcy5jdXJyZW50VmFsdWUpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5zZXRDbGFzcyhlbGVtU3ZnLCBjaGFuZ2VSZWNvcmQua2xhc3MucHJldmlvdXNWYWx1ZSwgbnVsbCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKGNoYW5nZVJlY29yZC52aWV3Qm94KSB7XG5cdFx0XHRpZiAodGhpcy5oZWxwZXIubG9hZGVkKSB7XG5cdFx0XHRcdHRoaXMuZGVzdHJveSgpO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy5pbml0KCk7XG5cdFx0fVxuXHRcdGlmIChjaGFuZ2VSZWNvcmQuYXBwbHlDc3MpIHtcblx0XHRcdGNvbnNvbGUud2FybignYXBwbHlDc3MgZGVwcmVjYXRlZCBzaW5jZSA5LjEuMCwgd2lsbCBiZSByZW1vdmVkIGluIDEwLjAuMCcpO1xuXHRcdFx0Y29uc29sZS53YXJuKCd1c2UgYXBwbHlDbGFzcyBpbnN0ZWFkJyk7XG5cdFx0fVxuXG5cdFx0aWYgKGNoYW5nZVJlY29yZC5zdmdBcmlhTGFiZWwpIHtcblx0XHRcdHRoaXMuZG9BcmlhKGNoYW5nZVJlY29yZC5zdmdBcmlhTGFiZWwuY3VycmVudFZhbHVlKTtcblx0XHR9XG5cdH1cblxuXHRuZ0RvQ2hlY2soKSB7XG5cdFx0aWYgKHRoaXMuaGVscGVyLnN2ZyAmJiB0aGlzLmhlbHBlci5kaWZmZXIpIHtcblx0XHRcdGNvbnN0IGNoYW5nZXMgPSB0aGlzLmhlbHBlci5kaWZmZXIuZGlmZih0aGlzLl9zdmdTdHlsZSEpO1xuXHRcdFx0aWYgKGNoYW5nZXMpIHtcblx0XHRcdFx0dGhpcy5hcHBseUNoYW5nZXMoY2hhbmdlcyk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBpbml0KCkge1xuXHRcdGlmICh0aGlzLm5hbWUpIHtcblx0XHRcdGNvbnN0IHN2Z09icyA9IHRoaXMuaWNvblJlZy5nZXRTdmdCeU5hbWUodGhpcy5uYW1lKTtcblx0XHRcdGlmIChzdmdPYnMpIHtcblx0XHRcdFx0dGhpcy5oZWxwZXIuaWNuU3ViID0gc3ZnT2JzLnN1YnNjcmliZShzdmcgPT4gdGhpcy5pbml0U3ZnKHN2ZykpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSBpZiAodGhpcy5zcmMpIHtcblx0XHRcdGNvbnN0IHN2Z09icyA9IHRoaXMuaWNvblJlZy5sb2FkU3ZnKHRoaXMuc3JjKTtcblx0XHRcdGlmIChzdmdPYnMpIHtcblx0XHRcdFx0dGhpcy5oZWxwZXIuaWNuU3ViID0gc3ZnT2JzLnN1YnNjcmliZShzdmcgPT4gdGhpcy5pbml0U3ZnKHN2ZykpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRjb25zdCBlbGVtID0gdGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQ7XG5cdFx0XHRlbGVtLmlubmVySFRNTCA9ICcnO1xuXHRcdFx0dGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBpbml0U3ZnKHN2ZzogU1ZHRWxlbWVudHx1bmRlZmluZWQpOiB2b2lkIHtcblx0XHRpZiAoIXRoaXMuaGVscGVyLmxvYWRlZCAmJiBzdmcpIHtcblx0XHRcdHRoaXMuc2V0U3ZnKHN2Zyk7XG5cdFx0XHR0aGlzLnJlc2V0RGlmZmVyKCk7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBkZXN0cm95KCkge1xuXHRcdGlmICh0aGlzLmhlbHBlci5pY25TdWIpIHtcblx0XHRcdHRoaXMuaGVscGVyLmljblN1Yi51bnN1YnNjcmliZSgpO1xuXHRcdH1cblx0XHR0aGlzLmhlbHBlciA9IG5ldyBTdmdJY29uSGVscGVyKCk7XG5cdH1cblxuXHRwcml2YXRlIHJlc2V0RGlmZmVyKCkge1xuXHRcdGlmICh0aGlzLl9zdmdTdHlsZSAmJiAhdGhpcy5oZWxwZXIuZGlmZmVyKSB7XG5cdFx0XHR0aGlzLmhlbHBlci5kaWZmZXIgPSB0aGlzLmRpZmZlcnMuZmluZCh0aGlzLl9zdmdTdHlsZSkuY3JlYXRlKCk7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBzZXRTdmcoc3ZnOiBTVkdFbGVtZW50KSB7XG5cdFx0aWYgKCF0aGlzLmhlbHBlci5sb2FkZWQgJiYgc3ZnKSB7XG5cdFx0XHR0aGlzLmhlbHBlci5zdmcgPSBzdmc7XG5cdFx0XHRjb25zdCBpY29uID0gc3ZnLmNsb25lTm9kZSh0cnVlKSBhcyBTVkdFbGVtZW50O1xuXHRcdFx0Y29uc3QgZWxlbSA9IHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50O1xuXG5cdFx0XHRlbGVtLmlubmVySFRNTCA9ICcnO1xuXHRcdFx0dGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZChlbGVtLCBpY29uKTtcblx0XHRcdHRoaXMuaGVscGVyLmxvYWRlZCA9IHRydWU7XG5cblx0XHRcdHRoaXMuY29weU5nQ29udGVudEF0dHJpYnV0ZShlbGVtLCBpY29uKTtcblxuXHRcdFx0aWYgKHRoaXMua2xhc3MgJiYgdGhpcy5hcHBseUNsYXNzKSB7XG5cdFx0XHRcdHRoaXMuc2V0Q2xhc3MoZWxlbS5maXJzdENoaWxkLCBudWxsLCB0aGlzLmtsYXNzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHRoaXMuc3ZnQ2xhc3MpIHtcblx0XHRcdFx0dGhpcy5zZXRDbGFzcyhlbGVtLmZpcnN0Q2hpbGQsIG51bGwsIHRoaXMuc3ZnQ2xhc3MpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGhpcy52aWV3Qm94KSB7XG5cdFx0XHRcdGlmICh0aGlzLnZpZXdCb3ggPT09ICdhdXRvJykge1xuXHRcdFx0XHRcdC8vIEF0dGVtcHQgdG8gY29udmVydCBoZWlnaHQgJiB3aWR0aCB0byBhIHZpZXdCb3guXG5cdFx0XHRcdFx0Y29uc3QgdyA9IGljb24uZ2V0QXR0cmlidXRlKCd3aWR0aCcpO1xuXHRcdFx0XHRcdGNvbnN0IGggPSBpY29uLmdldEF0dHJpYnV0ZSgnaGVpZ2h0Jyk7XG5cdFx0XHRcdFx0aWYgKGggJiYgdykge1xuXHRcdFx0XHRcdFx0Y29uc3QgdmIgPSBgMCAwICR7d30gJHtofWA7XG5cdFx0XHRcdFx0XHR0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShpY29uLCAndmlld0JveCcsIHZiKTtcblx0XHRcdFx0XHRcdHRoaXMucmVuZGVyZXIucmVtb3ZlQXR0cmlidXRlKGljb24sICd3aWR0aCcpO1xuXHRcdFx0XHRcdFx0dGhpcy5yZW5kZXJlci5yZW1vdmVBdHRyaWJ1dGUoaWNvbiwgJ2hlaWdodCcpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIGlmICh0aGlzLnZpZXdCb3ggIT09ICcnKSB7XG5cdFx0XHRcdFx0dGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoaWNvbiwgJ3ZpZXdCb3gnLCB0aGlzLnZpZXdCb3gpO1xuXHRcdFx0XHRcdHRoaXMucmVuZGVyZXIucmVtb3ZlQXR0cmlidXRlKGljb24sICd3aWR0aCcpO1xuXHRcdFx0XHRcdHRoaXMucmVuZGVyZXIucmVtb3ZlQXR0cmlidXRlKGljb24sICdoZWlnaHQnKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnN0eWxpemUoKTtcblxuXHRcdFx0Ly8gSWYgdGhlcmUgaXMgbm90IGEgc3ZnQXJpYUxhYmVsIGFuZCB0aGUgU1ZHIGhhcyBhbiBhcmlhbC1sYWJlbCwgdGhlbiBkbyBub3Qgb3ZlcnJpZGVcblx0XHRcdC8vIHRoZSBTVkcncyBhcmlhLWxhYmVsLlxuXHRcdFx0aWYgKCEodGhpcy5zdmdBcmlhTGFiZWwgPT09IHVuZGVmaW5lZCAmJiBlbGVtLmZpcnN0Q2hpbGQuaGFzQXR0cmlidXRlKCdhcmlhLWxhYmVsJykpKSB7XG5cdFx0XHRcdHRoaXMuZG9BcmlhKHRoaXMuc3ZnQXJpYUxhYmVsIHx8ICcnKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBjb3B5TmdDb250ZW50QXR0cmlidXRlKGhvc3RFbGVtOiBhbnksIGljb246IFNWR0VsZW1lbnQpIHtcblx0XHRjb25zdCBhdHRyaWJ1dGVzID0gaG9zdEVsZW0uYXR0cmlidXRlcyBhcyBOYW1lZE5vZGVNYXA7XG5cdFx0Y29uc3QgbGVuID0gYXR0cmlidXRlcy5sZW5ndGg7XG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkgKz0gMSkge1xuXHRcdFx0Y29uc3QgYXR0cmlidXRlID0gYXR0cmlidXRlcy5pdGVtKGkpO1xuXHRcdFx0aWYgKGF0dHJpYnV0ZSAmJiBhdHRyaWJ1dGUubmFtZS5zdGFydHNXaXRoKCdfbmdjb250ZW50JykpIHtcblx0XHRcdFx0dGhpcy5zZXROZ0NvbnRlbnRBdHRyaWJ1dGUoaWNvbiwgYXR0cmlidXRlLm5hbWUpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIHNldE5nQ29udGVudEF0dHJpYnV0ZShwYXJlbnQ6IE5vZGUsIGF0dHJpYnV0ZU5hbWU6IHN0cmluZykge1xuXHRcdHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHBhcmVudCwgYXR0cmlidXRlTmFtZSwgJycpO1xuXHRcdGNvbnN0IGxlbiA9IHBhcmVudC5jaGlsZE5vZGVzLmxlbmd0aDtcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSArPSAxKSB7XG5cdFx0XHRjb25zdCBjaGlsZCA9IHBhcmVudC5jaGlsZE5vZGVzW2ldO1xuXHRcdFx0aWYgKGNoaWxkIGluc3RhbmNlb2YgRWxlbWVudCkge1xuXHRcdFx0XHR0aGlzLnNldE5nQ29udGVudEF0dHJpYnV0ZShjaGlsZCwgYXR0cmlidXRlTmFtZSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBzdHlsaXplKCkge1xuXHRcdGlmICh0aGlzLmhlbHBlci5zdmcpIHtcblx0XHRcdGNvbnN0IHN2ZyA9IHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50LmZpcnN0Q2hpbGQ7XG5cblx0XHRcdGlmICh0aGlzLnN0cmV0Y2ggPT09IHRydWUpIHtcblx0XHRcdFx0dGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnLCAncHJlc2VydmVBc3BlY3RSYXRpbycsICdub25lJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHRoaXMuc3RyZXRjaCA9PT0gZmFsc2UpIHtcblx0XHRcdFx0dGhpcy5yZW5kZXJlci5yZW1vdmVBdHRyaWJ1dGUoc3ZnLCAncHJlc2VydmVBc3BlY3RSYXRpbycpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHByaXZhdGUgYXBwbHlDaGFuZ2VzKGNoYW5nZXM6IEtleVZhbHVlQ2hhbmdlczxzdHJpbmcsIHN0cmluZ3xudW1iZXI+KSB7XG5cdFx0Y2hhbmdlcy5mb3JFYWNoUmVtb3ZlZEl0ZW0oKHJlY29yZDogS2V5VmFsdWVDaGFuZ2VSZWNvcmQ8c3RyaW5nLCBzdHJpbmd8bnVtYmVyPikgPT4gdGhpcy5zZXRTdHlsZShyZWNvcmQua2V5LCBudWxsKSk7XG5cdFx0Y2hhbmdlcy5mb3JFYWNoQWRkZWRJdGVtKChyZWNvcmQ6IEtleVZhbHVlQ2hhbmdlUmVjb3JkPHN0cmluZywgc3RyaW5nfG51bWJlcj4pID0+IHRoaXMuc2V0U3R5bGUocmVjb3JkLmtleSwgcmVjb3JkLmN1cnJlbnRWYWx1ZSkpO1xuXHRcdGNoYW5nZXMuZm9yRWFjaENoYW5nZWRJdGVtKChyZWNvcmQ6IEtleVZhbHVlQ2hhbmdlUmVjb3JkPHN0cmluZywgc3RyaW5nfG51bWJlcj4pID0+IHRoaXMuc2V0U3R5bGUocmVjb3JkLmtleSwgcmVjb3JkLmN1cnJlbnRWYWx1ZSkpO1xuXHR9XG5cblx0cHJpdmF0ZSBzZXRTdHlsZShuYW1lQW5kVW5pdDogc3RyaW5nLCB2YWx1ZTogc3RyaW5nfG51bWJlcnxudWxsfHVuZGVmaW5lZCkge1xuXHRcdGNvbnN0IFtuYW1lLCB1bml0XSA9IG5hbWVBbmRVbml0LnNwbGl0KCcuJyk7XG5cdFx0dmFsdWUgPSB2YWx1ZSAhPT0gbnVsbCAmJiB1bml0ID8gYCR7dmFsdWV9JHt1bml0fWAgOiB2YWx1ZTtcblx0XHRjb25zdCBzdmcgPSB0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudC5maXJzdENoaWxkO1xuXG5cdFx0aWYgKHZhbHVlICE9PSBudWxsKSB7XG5cdFx0XHR0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHN2ZywgbmFtZSwgdmFsdWUgYXMgc3RyaW5nKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5yZW5kZXJlci5yZW1vdmVTdHlsZShzdmcsIG5hbWUpO1xuXHRcdH1cblx0fVxuXG5cdHByaXZhdGUgc2V0Q2xhc3ModGFyZ2V0OiBIVE1MRWxlbWVudHxTVkdTVkdFbGVtZW50LCBwcmV2aW91czogc3RyaW5nfHN0cmluZ1tdfG51bGwsIGN1cnJlbnQ6IHN0cmluZ3xzdHJpbmdbXXxudWxsKSB7XG5cdFx0aWYgKHRhcmdldCkge1xuXHRcdFx0aWYgKHByZXZpb3VzKSB7XG5cdFx0XHRcdGNvbnN0IGtsYXNzZXMgPSBBcnJheS5pc0FycmF5KHByZXZpb3VzKSA/IHByZXZpb3VzIDogcHJldmlvdXMuc3BsaXQoJyAnKTtcblx0XHRcdFx0Zm9yIChjb25zdCBrIG9mIGtsYXNzZXMpIHtcblx0XHRcdFx0XHR0aGlzLnJlbmRlcmVyLnJlbW92ZUNsYXNzKHRhcmdldCwgayk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdGlmIChjdXJyZW50KSB7XG5cdFx0XHRcdGNvbnN0IGtsYXNzZXMgPSBBcnJheS5pc0FycmF5KGN1cnJlbnQpID8gY3VycmVudCA6IGN1cnJlbnQuc3BsaXQoJyAnKTtcblx0XHRcdFx0Zm9yIChjb25zdCBrIG9mIGtsYXNzZXMpIHtcblx0XHRcdFx0XHR0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRhcmdldCwgayk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIGRvQXJpYShsYWJlbDogc3RyaW5nKSB7XG5cdFx0Y29uc3Qgc3ZnID0gdGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZmlyc3RDaGlsZDtcblx0XHRpZiAoc3ZnKSB7XG5cdFx0XHRpZiAobGFiZWwgPT09ICcnKSB7XG5cdFx0XHRcdHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2ZywgJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTtcblx0XHRcdFx0dGhpcy5yZW5kZXJlci5yZW1vdmVBdHRyaWJ1dGUoc3ZnLCAnYXJpYS1sYWJlbCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5yZW5kZXJlci5yZW1vdmVBdHRyaWJ1dGUoc3ZnLCAnYXJpYS1oaWRkZW4nKTtcblx0XHRcdFx0dGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnLCAnYXJpYS1sYWJlbCcsIGxhYmVsKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxufVxuIl19