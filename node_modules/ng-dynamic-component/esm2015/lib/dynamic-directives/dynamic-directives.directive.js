/**
 * @fileoverview added by tsickle
 * Generated from: lib/dynamic-directives/dynamic-directives.directive.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, ElementRef, EventEmitter, Inject, Injector, Input, IterableDiffers, Optional, Output, } from '@angular/core';
import { DynamicComponentInjectorToken, } from '../component-injector/token';
import { IoFactoryService } from '../io/io-factory.service';
import { extractNgParamTypes, getCtorParamTypes } from '../util';
import { WindowRefService } from '../window-ref/window-ref.service';
/**
 * @record
 * @template T
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../io/io-factory.service';
import * as ɵngcc2 from '../window-ref/window-ref.service';
export function DynamicDirectiveDef() { }
if (false) {
    /** @type {?} */
    DynamicDirectiveDef.prototype.type;
    /** @type {?|undefined} */
    DynamicDirectiveDef.prototype.inputs;
    /** @type {?|undefined} */
    DynamicDirectiveDef.prototype.outputs;
}
/**
 * @template T
 * @param {?} type
 * @param {?=} inputs
 * @param {?=} outputs
 * @return {?}
 */
export function dynamicDirectiveDef(type, inputs, outputs) {
    return { type, inputs, outputs };
}
/**
 * @record
 * @template T
 */
export function DirectiveRef() { }
if (false) {
    /** @type {?} */
    DirectiveRef.prototype.instance;
    /** @type {?} */
    DirectiveRef.prototype.type;
    /** @type {?} */
    DirectiveRef.prototype.injector;
    /** @type {?} */
    DirectiveRef.prototype.hostComponent;
    /** @type {?} */
    DirectiveRef.prototype.hostView;
    /** @type {?} */
    DirectiveRef.prototype.location;
    /** @type {?} */
    DirectiveRef.prototype.changeDetectorRef;
    /** @type {?} */
    DirectiveRef.prototype.onDestroy;
}
export class DynamicDirectivesDirective {
    /**
     * @param {?} iterableDiffers
     * @param {?} ioFactoryService
     * @param {?} windowRef
     * @param {?=} componentInjector
     */
    constructor(iterableDiffers, ioFactoryService, windowRef, componentInjector) {
        this.iterableDiffers = iterableDiffers;
        this.ioFactoryService = ioFactoryService;
        this.windowRef = windowRef;
        this.componentInjector = componentInjector;
        this.ndcDynamicDirectivesCreated = new EventEmitter();
        this.dirRef = new Map();
        this.dirIo = new Map();
        this.dirsDiffer = this.iterableDiffers
            .find([])
            .create((/**
         * @param {?} _
         * @param {?} def
         * @return {?}
         */
        (_, def) => def.type));
    }
    /**
     * @private
     * @return {?}
     */
    get directives() {
        return (this.ndcDynamicDirectives || this.ngComponentOutletNdcDynamicDirectives);
    }
    /**
     * @private
     * @return {?}
     */
    get componentRef() {
        return this.componentInjector.componentRef;
    }
    /**
     * @private
     * @return {?}
     */
    get compInstance() {
        return this.componentRef && this.componentRef.instance;
    }
    /**
     * @private
     * @return {?}
     */
    get isCompChanged() {
        if (this.lastCompInstance !== this.compInstance) {
            this.lastCompInstance = this.compInstance;
            return true;
        }
        return false;
    }
    /**
     * @private
     * @return {?}
     */
    get hostInjector() {
        return this.componentRef.injector;
    }
    /**
     * @private
     * @return {?}
     */
    get hostVcr() {
        // NOTE: Accessing private APIs of Angular
        // tslint:disable-next-line: no-string-literal
        return this.componentRef['_viewRef']['_viewContainerRef'];
    }
    /**
     * @private
     * @return {?}
     */
    get reflect() {
        return ((/** @type {?} */ (this.windowRef.nativeWindow))).Reflect;
    }
    /**
     * @return {?}
     */
    ngDoCheck() {
        if (this.maybeDestroyDirectives()) {
            return;
        }
        /** @type {?} */
        const dirsChanges = this.dirsDiffer.diff(this.directives);
        if (!dirsChanges) {
            return this.updateDirectives();
        }
        this.processDirChanges(dirsChanges);
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.destroyAllDirectives();
    }
    /**
     * @private
     * @return {?}
     */
    maybeDestroyDirectives() {
        if (this.isCompChanged || !this.componentRef) {
            this.dirsDiffer.diff([]);
            this.destroyAllDirectives();
        }
        return !this.componentRef;
    }
    /**
     * @private
     * @param {?} changes
     * @return {?}
     */
    processDirChanges(changes) {
        changes.forEachRemovedItem((/**
         * @param {?} __0
         * @return {?}
         */
        ({ item }) => this.destroyDirective(item)));
        /** @type {?} */
        const createdDirs = [];
        changes.forEachAddedItem((/**
         * @param {?} __0
         * @return {?}
         */
        ({ item }) => createdDirs.push(this.initDirective(item))));
        if (createdDirs.length) {
            this.ndcDynamicDirectivesCreated.emit(createdDirs.filter(Boolean));
        }
    }
    /**
     * @private
     * @return {?}
     */
    updateDirectives() {
        this.directives.forEach((/**
         * @param {?} dir
         * @return {?}
         */
        dir => this.updateDirective(dir)));
    }
    /**
     * @private
     * @param {?} dirDef
     * @return {?}
     */
    updateDirective(dirDef) {
        /** @type {?} */
        const io = this.dirIo.get(dirDef.type);
        io.update(dirDef.inputs, dirDef.outputs, false, false);
        io.maybeUpdate();
    }
    /**
     * @private
     * @param {?} dirDef
     * @return {?}
     */
    initDirective(dirDef) {
        if (this.dirRef.has(dirDef.type)) {
            return;
        }
        /** @type {?} */
        const instance = this.createDirective(dirDef.type);
        /** @type {?} */
        const dir = {
            instance,
            type: dirDef.type,
            injector: this.hostInjector,
            hostComponent: this.componentRef.instance,
            hostView: this.componentRef.hostView,
            location: this.componentRef.location,
            changeDetectorRef: this.componentRef.changeDetectorRef,
            onDestroy: this.componentRef.onDestroy,
        };
        this.initDirIO(dir, dirDef.inputs, dirDef.outputs);
        this.callInitHooks(instance);
        this.dirRef.set(dir.type, dir);
        return dir;
    }
    /**
     * @private
     * @return {?}
     */
    destroyAllDirectives() {
        this.dirRef.forEach((/**
         * @param {?} dir
         * @return {?}
         */
        dir => this.destroyDirRef(dir)));
        this.dirRef.clear();
        this.dirIo.clear();
    }
    /**
     * @private
     * @param {?} dirDef
     * @return {?}
     */
    destroyDirective(dirDef) {
        this.destroyDirRef(this.dirRef.get(dirDef.type));
        this.dirRef.delete(dirDef.type);
        this.dirIo.delete(dirDef.type);
    }
    /**
     * @private
     * @param {?} dir
     * @param {?=} inputs
     * @param {?=} outputs
     * @return {?}
     */
    initDirIO(dir, inputs, outputs) {
        /** @type {?} */
        const io = this.ioFactoryService.create();
        io.init({ componentRef: this.dirToCompDef(dir) }, { trackOutputChanges: true });
        io.update(inputs, outputs, !!inputs, !!outputs);
        this.dirIo.set(dir.type, io);
    }
    /**
     * @private
     * @param {?} dir
     * @return {?}
     */
    dirToCompDef(dir) {
        return {
            changeDetectorRef: this.componentRef.changeDetectorRef,
            hostView: this.componentRef.hostView,
            location: this.componentRef.location,
            destroy: this.componentRef.destroy,
            onDestroy: this.componentRef.onDestroy,
            injector: this.componentRef.injector,
            instance: dir.instance,
            componentType: dir.type,
        };
    }
    /**
     * @private
     * @param {?} dir
     * @return {?}
     */
    destroyDirRef(dir) {
        /** @type {?} */
        const io = this.dirIo.get(dir.type);
        io.ngOnDestroy();
        if ('ngOnDestroy' in dir.instance) {
            dir.instance.ngOnDestroy();
        }
    }
    /**
     * @private
     * @template T
     * @param {?} dirType
     * @return {?}
     */
    createDirective(dirType) {
        /** @type {?} */
        const directiveInjector = Injector.create({
            providers: [
                {
                    provide: dirType,
                    useClass: dirType,
                    deps: this.resolveDirParamTypes(dirType),
                },
                { provide: ElementRef, useValue: this.componentRef.location },
            ],
            parent: this.hostInjector,
            name: `DynamicDirectiveInjector:${dirType.name}@${this.componentRef.componentType.name}`,
        });
        return directiveInjector.get(dirType);
    }
    /**
     * @private
     * @param {?} dirType
     * @return {?}
     */
    resolveDirParamTypes(dirType) {
        var _a, _b;
        return ((_b = (_a = 
        // First try Angular Compiler's metadata
        extractNgParamTypes(dirType)) !== null && _a !== void 0 ? _a : 
        // Then fallback to Typescript Reflect API
        getCtorParamTypes(dirType, this.reflect)) !== null && _b !== void 0 ? _b : 
        // Bailout
        []);
    }
    /**
     * @private
     * @param {?} obj
     * @return {?}
     */
    callInitHooks(obj) {
        this.callHook(obj, 'ngOnInit');
        this.callHook(obj, 'ngDoCheck');
        this.callHook(obj, 'ngAfterContentInit');
        this.callHook(obj, 'ngAfterContentChecked');
        this.callHook(obj, 'ngAfterViewInit');
        this.callHook(obj, 'ngAfterViewChecked');
    }
    /**
     * @private
     * @param {?} obj
     * @param {?} hook
     * @param {?=} args
     * @return {?}
     */
    callHook(obj, hook, args = []) {
        if (obj[hook]) {
            obj[hook](...args);
        }
    }
}
DynamicDirectivesDirective.ɵfac = function DynamicDirectivesDirective_Factory(t) { return new (t || DynamicDirectivesDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.IterableDiffers), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.IoFactoryService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.WindowRefService), ɵngcc0.ɵɵdirectiveInject(DynamicComponentInjectorToken, 8)); };
DynamicDirectivesDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: DynamicDirectivesDirective, selectors: [["", "ndcDynamicDirectives", ""], ["", "ngComponentOutletNdcDynamicDirectives", ""]], inputs: { ndcDynamicDirectives: "ndcDynamicDirectives", ngComponentOutletNdcDynamicDirectives: "ngComponentOutletNdcDynamicDirectives" }, outputs: { ndcDynamicDirectivesCreated: "ndcDynamicDirectivesCreated" } });
/** @nocollapse */
DynamicDirectivesDirective.ctorParameters = () => [
    { type: IterableDiffers },
    { type: IoFactoryService },
    { type: WindowRefService },
    { type: undefined, decorators: [{ type: Inject, args: [DynamicComponentInjectorToken,] }, { type: Optional }] }
];
DynamicDirectivesDirective.propDecorators = {
    ndcDynamicDirectives: [{ type: Input }],
    ngComponentOutletNdcDynamicDirectives: [{ type: Input }],
    ndcDynamicDirectivesCreated: [{ type: Output }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DynamicDirectivesDirective, [{
        type: Directive,
        args: [{
                selector: '[ndcDynamicDirectives],[ngComponentOutletNdcDynamicDirectives]'
            }]
    }], function () { return [{ type: ɵngcc0.IterableDiffers }, { type: ɵngcc1.IoFactoryService }, { type: ɵngcc2.WindowRefService }, { type: undefined, decorators: [{
                type: Inject,
                args: [DynamicComponentInjectorToken]
            }, {
                type: Optional
            }] }]; }, { ndcDynamicDirectivesCreated: [{
            type: Output
        }], ndcDynamicDirectives: [{
            type: Input
        }], ngComponentOutletNdcDynamicDirectives: [{
            type: Input
        }] }); })();
if (false) {
    /** @type {?} */
    DynamicDirectivesDirective.prototype.ndcDynamicDirectives;
    /** @type {?} */
    DynamicDirectivesDirective.prototype.ngComponentOutletNdcDynamicDirectives;
    /** @type {?} */
    DynamicDirectivesDirective.prototype.ndcDynamicDirectivesCreated;
    /**
     * @type {?}
     * @private
     */
    DynamicDirectivesDirective.prototype.lastCompInstance;
    /**
     * @type {?}
     * @private
     */
    DynamicDirectivesDirective.prototype.dirRef;
    /**
     * @type {?}
     * @private
     */
    DynamicDirectivesDirective.prototype.dirIo;
    /**
     * @type {?}
     * @private
     */
    DynamicDirectivesDirective.prototype.dirsDiffer;
    /**
     * @type {?}
     * @private
     */
    DynamicDirectivesDirective.prototype.iterableDiffers;
    /**
     * @type {?}
     * @private
     */
    DynamicDirectivesDirective.prototype.ioFactoryService;
    /**
     * @type {?}
     * @private
     */
    DynamicDirectivesDirective.prototype.windowRef;
    /**
     * @type {?}
     * @private
     */
    DynamicDirectivesDirective.prototype.componentInjector;
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pYy1kaXJlY3RpdmVzLmRpcmVjdGl2ZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmctZHluYW1pYy1jb21wb25lbnQvc3JjL2xpYi9keW5hbWljLWRpcmVjdGl2ZXMvZHluYW1pYy1kaXJlY3RpdmVzLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFHTCxTQUFTLEVBRVQsVUFBVSxFQUNWLFlBQVksRUFDWixNQUFNLEVBQ04sUUFBUSxFQUNSLEtBQUssRUFFTCxlQUFlLEVBRWYsUUFBUSxFQUNSLE1BQU0sR0FJUCxNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBRUwsNkJBQTZCLEdBQzlCLE1BQU0sNkJBQTZCLENBQUM7QUFDckMsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFHNUQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLGlCQUFpQixFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQ2pFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBQ3BFO0FBQ0c7QUFBVztBQUFlOzs7O0FBQTdCLHlDQUlDO0FBQ0Q7QUFDWTtBQUFxQixJQUwvQixtQ0FBYztBQUNoQjtBQUNRLElBRE4scUNBQW9CO0FBQ3RCO0FBR0csSUFIRCxzQ0FBc0I7QUFDeEI7QUFDQTtBQUNHO0FBQWU7QUFBbUI7QUFFbkM7QUFDQTtBQUFlO0FBSGpCLE1BQU0sVUFBVSxtQkFBbUIsQ0FDakMsSUFBYSxFQUNiLE1BQW1CLEVBQ25CLE9BQXFCO0FBQ3JCLElBQ0EsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLENBQUM7QUFDbkMsQ0FBQztBQUNEO0FBQ0c7QUFBVztBQUFlO0FBQTdCLGtDQVVDO0FBQ0Q7QUFDWTtBQUNRLElBWmxCLGdDQUFZO0FBQ2Q7QUFDSSxJQURGLDRCQUFjO0FBQ2hCO0FBQXFCLElBQW5CLGdDQUFtQjtBQUNyQjtBQUFxQixJQUFuQixxQ0FBeUI7QUFDM0I7QUFDQSxJQURFLGdDQUFrQjtBQUNwQjtBQUFxQixJQUFuQixnQ0FBcUI7QUFDdkI7QUFBcUIsSUFBbkIseUNBQXFDO0FBQ3ZDO0FBQXFCLElBQ25CLGlDQUF3QztBQUMxQztBQUtBLE1BQU0sT0FBTywwQkFBMEI7QUFBRztBQUFRO0FBRWpEO0FBQW1DO0FBRW5DO0FBQXFDO0FBQVEsSUFpRDVDLFlBQ1UsZUFBZ0MsRUFDaEMsZ0JBQWtDLEVBQ2xDLFNBQTJCLEVBRzNCLGlCQUE0QztBQUN0RCxRQU5VLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtBQUFDLFFBQ2pDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7QUFBQyxRQUNuQyxjQUFTLEdBQVQsU0FBUyxDQUFrQjtBQUFDLFFBRzVCLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBMkI7QUFBQyxRQXBEdkQsZ0NBQTJCLEdBQUcsSUFBSSxZQUFZLEVBQXVCLENBQUM7QUFDeEUsUUF1Q1UsV0FBTSxHQUFHLElBQUksR0FBRyxFQUFnQyxDQUFDO0FBQzNELFFBQVUsVUFBSyxHQUFHLElBQUksR0FBRyxFQUF3QixDQUFDO0FBQ2xELFFBQVUsZUFBVSxHQUFHLElBQUksQ0FBQyxlQUFlO0FBQzNDLGFBQUssSUFBSSxDQUFDLEVBQUUsQ0FBQztBQUNiLGFBQUssTUFBTTtBQUFNO0FBQXdCO0FBRXBDO0FBQ1E7QUFBWSxRQUhhLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksRUFBQyxDQUFDO0FBQzVELElBUUssQ0FBQztBQUNOO0FBQ087QUFDTjtBQUFtQjtBQUFRLElBcEQxQixJQUFZLFVBQVU7QUFDeEIsUUFBSSxPQUFPLENBQ0wsSUFBSSxDQUFDLG9CQUFvQixJQUFJLElBQUksQ0FBQyxxQ0FBcUMsQ0FDeEUsQ0FBQztBQUNOLElBQUUsQ0FBQztBQUNIO0FBQ087QUFBZ0I7QUFDWjtBQUFRLElBRGpCLElBQVksWUFBWTtBQUMxQixRQUFJLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQztBQUMvQyxJQUFFLENBQUM7QUFDSDtBQUNPO0FBQWdCO0FBQ1o7QUFBUSxJQURqQixJQUFZLFlBQVk7QUFDMUIsUUFBSSxPQUFPLElBQUksQ0FBQyxZQUFZLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUM7QUFDM0QsSUFBRSxDQUFDO0FBQ0g7QUFDTztBQUFnQjtBQUNiO0FBQVEsSUFEaEIsSUFBWSxhQUFhO0FBQzNCLFFBQUksSUFBSSxJQUFJLENBQUMsZ0JBQWdCLEtBQUssSUFBSSxDQUFDLFlBQVksRUFBRTtBQUNyRCxZQUFNLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDO0FBQ2hELFlBQU0sT0FBTyxJQUFJLENBQUM7QUFDbEIsU0FBSztBQUNMLFFBQUksT0FBTyxLQUFLLENBQUM7QUFDakIsSUFBRSxDQUFDO0FBQ0g7QUFDTztBQUFnQjtBQUNaO0FBQVEsSUFEakIsSUFBWSxZQUFZO0FBQzFCLFFBQUksT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQztBQUN0QyxJQUFFLENBQUM7QUFDSDtBQUNPO0FBQWdCO0FBQW1CO0FBQ3BDLElBREosSUFBWSxPQUFPO0FBQUssUUFDdEIsMENBQTBDO0FBQzlDLFFBQUksOENBQThDO0FBQ2xELFFBQUksT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxDQUFDLG1CQUFtQixDQUFDLENBQUM7QUFDOUQsSUFBRSxDQUFDO0FBQ0g7QUFDTztBQUFnQjtBQUNQO0FBQVEsSUFEdEIsSUFBWSxPQUFPO0FBQ3JCLFFBQUksT0FBTyxDQUFDLG1CQUFBLElBQUksQ0FBQyxTQUFTLENBQUMsWUFBWSxFQUFPLENBQUMsQ0FBQyxPQUFPLENBQUM7QUFDeEQsSUFBRSxDQUFDO0FBQ0g7QUFDTztBQUFtQjtBQUFRLElBZWhDLFNBQVM7QUFBSyxRQUNaLElBQUksSUFBSSxDQUFDLHNCQUFzQixFQUFFLEVBQUU7QUFDdkMsWUFBTSxPQUFPO0FBQ2IsU0FBSztBQUNMO0FBQ3dCLGNBQWQsV0FBVyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUM7QUFDN0QsUUFDSSxJQUFJLENBQUMsV0FBVyxFQUFFO0FBQ3RCLFlBQU0sT0FBTyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztBQUNyQyxTQUFLO0FBQ0wsUUFDSSxJQUFJLENBQUMsaUJBQWlCLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDeEMsSUFBRSxDQUFDO0FBQ0g7QUFDTztBQUNMO0FBQVEsSUFEUixXQUFXO0FBQUssUUFDZCxJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztBQUNoQyxJQUFFLENBQUM7QUFDSDtBQUNPO0FBQWdCO0FBQ2xCO0FBQVEsSUFESCxzQkFBc0I7QUFDaEMsUUFBSSxJQUFJLElBQUksQ0FBQyxhQUFhLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFO0FBQ2xELFlBQU0sSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7QUFDL0IsWUFBTSxJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztBQUNsQyxTQUFLO0FBQ0wsUUFDSSxPQUFPLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQztBQUM5QixJQUFFLENBQUM7QUFDSDtBQUNPO0FBQWdCO0FBQ0g7QUFBbUI7QUFBUSxJQURyQyxpQkFBaUIsQ0FDdkIsT0FBa0Q7QUFDcEQsUUFDRSxPQUFPLENBQUMsa0JBQWtCO0FBQU07QUFBMEI7QUFFckQ7QUFBWSxRQUZVLENBQUMsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxFQUFDLENBQUM7QUFDMUU7QUFDd0IsY0FBZCxXQUFXLEdBQUcsRUFBRTtBQUMxQixRQUFJLE9BQU8sQ0FBQyxnQkFBZ0I7QUFBTTtBQUNqQjtBQUF1QjtBQUN0QyxRQUYyQixDQUFDLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxDQUNwQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUMsRUFDM0MsQ0FBQztBQUNOLFFBQ0ksSUFBSSxXQUFXLENBQUMsTUFBTSxFQUFFO0FBQzVCLFlBQU0sSUFBSSxDQUFDLDJCQUEyQixDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7QUFDekUsU0FBSztBQUNMLElBQUUsQ0FBQztBQUNIO0FBQ087QUFBZ0I7QUFDWjtBQUFRLElBRFQsZ0JBQWdCO0FBQzFCLFFBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPO0FBQU07QUFBMEI7QUFHN0M7QUFBWSxRQUhFLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsRUFBQyxDQUFDO0FBQzlELElBQUUsQ0FBQztBQUNIO0FBQ087QUFBZ0I7QUFBeUI7QUFDM0M7QUFBUSxJQURILGVBQWUsQ0FBQyxNQUFnQztBQUMxRDtBQUF5QixjQUFmLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO0FBQzFDLFFBQUksRUFBRSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQzNELFFBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDO0FBQ3JCLElBQUUsQ0FBQztBQUNIO0FBQ087QUFBZ0I7QUFDQTtBQUNuQjtBQUFRLElBRkYsYUFBYSxDQUNuQixNQUFnQztBQUNsQyxRQUNFLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ3RDLFlBQU0sT0FBTztBQUNiLFNBQUs7QUFDTDtBQUN3QixjQUFkLFFBQVEsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7QUFDdEQ7QUFDTyxjQURHLEdBQUcsR0FBRztBQUNoQixZQUFNLFFBQVE7QUFDZCxZQUFNLElBQUksRUFBRSxNQUFNLENBQUMsSUFBSTtBQUN2QixZQUFNLFFBQVEsRUFBRSxJQUFJLENBQUMsWUFBWTtBQUNqQyxZQUFNLGFBQWEsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVE7QUFDL0MsWUFBTSxRQUFRLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRO0FBQzFDLFlBQU0sUUFBUSxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUTtBQUMxQyxZQUFNLGlCQUFpQixFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsaUJBQWlCO0FBQzVELFlBQU0sU0FBUyxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsU0FBUztBQUM1QyxTQUFLO0FBQ0wsUUFDSSxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUN2RCxRQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDakMsUUFDSSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0FBQ25DLFFBQ0ksT0FBTyxHQUFHLENBQUM7QUFDZixJQUFFLENBQUM7QUFDSDtBQUNPO0FBQWdCO0FBQ2hCO0FBQVEsSUFETCxvQkFBb0I7QUFDOUIsUUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU87QUFBTTtBQUEwQjtBQUNsQztBQUNiLFFBRmdCLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsRUFBQyxDQUFDO0FBQ3hELFFBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztBQUN4QixRQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUM7QUFDdkIsSUFBRSxDQUFDO0FBQ0g7QUFDTztBQUFnQjtBQUF5QjtBQUM1QztBQUFRLElBREYsZ0JBQWdCLENBQUMsTUFBZ0M7QUFDM0QsUUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0FBQ3JELFFBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3BDLFFBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ25DLElBQUUsQ0FBQztBQUNIO0FBQ087QUFBZ0I7QUFBc0I7QUFBMEI7QUFDaEQ7QUFBbUI7QUFDdkMsSUFGTyxTQUFTLENBQUMsR0FBc0IsRUFBRSxNQUFZLEVBQUUsT0FBYTtBQUN2RTtBQUF5QixjQUFmLEVBQUUsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFO0FBQzdDLFFBQUksRUFBRSxDQUFDLElBQUksQ0FDTCxFQUFFLFlBQVksRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQ3hDLEVBQUUsa0JBQWtCLEVBQUUsSUFBSSxFQUFFLENBQzdCLENBQUM7QUFDTixRQUFJLEVBQUUsQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUNwRCxRQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFDakMsSUFBRSxDQUFDO0FBQ0g7QUFDTztBQUFnQjtBQUFzQjtBQUFtQjtBQUM1RCxJQURNLFlBQVksQ0FBQyxHQUFzQjtBQUFJLFFBQzdDLE9BQU87QUFDWCxZQUFNLGlCQUFpQixFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsaUJBQWlCO0FBQzVELFlBQU0sUUFBUSxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUTtBQUMxQyxZQUFNLFFBQVEsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVE7QUFDMUMsWUFBTSxPQUFPLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPO0FBQ3hDLFlBQU0sU0FBUyxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsU0FBUztBQUM1QyxZQUFNLFFBQVEsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVE7QUFDMUMsWUFBTSxRQUFRLEVBQUUsR0FBRyxDQUFDLFFBQVE7QUFDNUIsWUFBTSxhQUFhLEVBQUUsR0FBRyxDQUFDLElBQUk7QUFDN0IsU0FBSyxDQUFDO0FBQ04sSUFBRSxDQUFDO0FBQ0g7QUFDTztBQUFnQjtBQUFzQjtBQUMvQjtBQUFRLElBRFosYUFBYSxDQUFDLEdBQXNCO0FBQzlDO0FBQXlCLGNBQWYsRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUM7QUFDdkMsUUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUM7QUFDckIsUUFDSSxJQUFJLGFBQWEsSUFBSSxHQUFHLENBQUMsUUFBUSxFQUFFO0FBQ3ZDLFlBQU0sR0FBRyxDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsQ0FBQztBQUNqQyxTQUFLO0FBQ0wsSUFBRSxDQUFDO0FBQ0g7QUFDTztBQUFnQjtBQUFtQjtBQUMxQjtBQUFtQjtBQUFRLElBRGpDLGVBQWUsQ0FBSSxPQUFnQjtBQUFJO0FBQzNCLGNBQVosaUJBQWlCLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQztBQUM5QyxZQUFNLFNBQVMsRUFBRTtBQUNqQixnQkFBUTtBQUNSLG9CQUFVLE9BQU8sRUFBRSxPQUFPO0FBQzFCLG9CQUFVLFFBQVEsRUFBRSxPQUFPO0FBQzNCLG9CQUFVLElBQUksRUFBRSxJQUFJLENBQUMsb0JBQW9CLENBQUMsT0FBTyxDQUFDO0FBQ2xELGlCQUFTO0FBQ1QsZ0JBQVEsRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRTtBQUNyRSxhQUFPO0FBQ1AsWUFBTSxNQUFNLEVBQUUsSUFBSSxDQUFDLFlBQVk7QUFDL0IsWUFBTSxJQUFJLEVBQUUsNEJBQTRCLE9BQU8sQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFO0FBQzlGLFNBQUssQ0FBQztBQUNOLFFBQ0ksT0FBTyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDMUMsSUFBRSxDQUFDO0FBQ0g7QUFDTztBQUFnQjtBQUEwQjtBQUN6QztBQUNMLElBRk8sb0JBQW9CLENBQUMsT0FBa0I7QUFBSTtBQUVyRCxRQURJLE9BQU87QUFDQyxRQUFOLHdDQUF3QztBQUM5QyxRQUFNLG1CQUFtQixDQUFDLE9BQU8sQ0FBQztBQUNGLFFBQTFCLDBDQUEwQztBQUNoRCxRQUFNLGlCQUFpQixDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDO0FBR3hDLFFBRkEsVUFBVTtBQUNoQixRQUFNLEVBQUUsQ0FDSCxDQUFDO0FBQ04sSUFBRSxDQUFDO0FBQ0g7QUFDTztBQUFnQjtBQUNkO0FBQW1CO0FBQzVCLElBRlUsYUFBYSxDQUFDLEdBQVE7QUFDaEMsUUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxVQUFVLENBQUMsQ0FBQztBQUNuQyxRQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0FBQ3BDLFFBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsb0JBQW9CLENBQUMsQ0FBQztBQUM3QyxRQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFLHVCQUF1QixDQUFDLENBQUM7QUFDaEQsUUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO0FBQzFDLFFBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsb0JBQW9CLENBQUMsQ0FBQztBQUM3QyxJQUFFLENBQUM7QUFDSDtBQUNPO0FBQWdCO0FBQXNCO0FBQ3hDO0FBQ0c7QUFDUDtBQUNFLElBSk8sUUFBUSxDQUFDLEdBQVEsRUFBRSxJQUFZLEVBQUUsT0FBYyxFQUFFO0FBQzNELFFBQUksSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUU7QUFDbkIsWUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQztBQUN6QixTQUFLO0FBQ0wsSUFBRSxDQUFDO0FBQ0g7c0RBdE9DLFNBQVMsU0FBQyxrQkFDVCxRQUFRLEVBQUUsZ0VBQWdFLGVBQzNFO29hQUNJO0FBQUM7QUFBbUI7QUFDcEIsWUFqREgsZUFBZTtBQUNmLFlBWU8sZ0JBQWdCO0FBQUksWUFJcEIsZ0JBQWdCO0FBQUksNENBd0Z4QixNQUFNLFNBQUMsNkJBQTZCLGNBQ3BDLFFBQVE7QUFDVjtBQUFHO0FBQThDLG1DQTFEakQsS0FBSztBQUNOLG9EQUNDLEtBQUs7QUFDTiwwQ0FFQyxNQUFNO0FBQ1I7Ozs7Ozs7Ozs7Ozs7Ozs7O29CQUFFO0FBQUM7QUFBYTtBQUFxQixJQU5wQywwREFDaUQ7QUFDbkQ7QUFDVSxJQURSLDJFQUNrRTtBQUNwRTtBQUVRLElBRE4saUVBQ3NFO0FBQ3hFO0FBQ087QUFBaUI7QUFFbEI7QUFBUSxJQUZaLHNEQUE4QjtBQUNoQztBQUNPO0FBQWlCO0FBQ2I7QUFDTCxJQWtDSiw0Q0FBeUQ7QUFDM0Q7QUFBUTtBQUFpQjtBQUFnQjtBQUFRLElBQS9DLDJDQUFnRDtBQUNsRDtBQUFRO0FBQWlCO0FBQWdCO0FBQ3BDLElBREgsZ0RBRTBEO0FBQzVEO0FBQ087QUFDRTtBQUFnQjtBQUFRLElBQTdCLHFEQUF3QztBQUFDO0FBQ3RDO0FBQWlCO0FBQWdCO0FBQ3hDLElBREksc0RBQTBDO0FBQUM7QUFDeEM7QUFBaUI7QUFBZ0I7QUFDakMsSUFESCwrQ0FBbUM7QUFBQztBQUNqQztBQUFpQjtBQUFnQjtBQUNuQyxJQURELHVEQUVvRDtBQUFDO0FBQ3hEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudFJlZixcbiAgRGlyZWN0aXZlLFxuICBEb0NoZWNrLFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIEluamVjdCxcbiAgSW5qZWN0b3IsXG4gIElucHV0LFxuICBJdGVyYWJsZUNoYW5nZXMsXG4gIEl0ZXJhYmxlRGlmZmVycyxcbiAgT25EZXN0cm95LFxuICBPcHRpb25hbCxcbiAgT3V0cHV0LFxuICBUeXBlLFxuICBWaWV3Q29udGFpbmVyUmVmLFxuICBWaWV3UmVmLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHtcbiAgRHluYW1pY0NvbXBvbmVudEluamVjdG9yLFxuICBEeW5hbWljQ29tcG9uZW50SW5qZWN0b3JUb2tlbixcbn0gZnJvbSAnLi4vY29tcG9uZW50LWluamVjdG9yL3Rva2VuJztcbmltcG9ydCB7IElvRmFjdG9yeVNlcnZpY2UgfSBmcm9tICcuLi9pby9pby1mYWN0b3J5LnNlcnZpY2UnO1xuaW1wb3J0IHsgSW9TZXJ2aWNlIH0gZnJvbSAnLi4vaW8vaW8uc2VydmljZSc7XG5pbXBvcnQgeyBJbnB1dHNUeXBlLCBPdXRwdXRzVHlwZSB9IGZyb20gJy4uL2lvL3R5cGVzJztcbmltcG9ydCB7IGV4dHJhY3ROZ1BhcmFtVHlwZXMsIGdldEN0b3JQYXJhbVR5cGVzIH0gZnJvbSAnLi4vdXRpbCc7XG5pbXBvcnQgeyBXaW5kb3dSZWZTZXJ2aWNlIH0gZnJvbSAnLi4vd2luZG93LXJlZi93aW5kb3ctcmVmLnNlcnZpY2UnO1xuXG5leHBvcnQgaW50ZXJmYWNlIER5bmFtaWNEaXJlY3RpdmVEZWY8VD4ge1xuICB0eXBlOiBUeXBlPFQ+O1xuICBpbnB1dHM/OiBJbnB1dHNUeXBlO1xuICBvdXRwdXRzPzogT3V0cHV0c1R5cGU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkeW5hbWljRGlyZWN0aXZlRGVmPFQ+KFxuICB0eXBlOiBUeXBlPFQ+LFxuICBpbnB1dHM/OiBJbnB1dHNUeXBlLFxuICBvdXRwdXRzPzogT3V0cHV0c1R5cGUsXG4pOiBEeW5hbWljRGlyZWN0aXZlRGVmPFQ+IHtcbiAgcmV0dXJuIHsgdHlwZSwgaW5wdXRzLCBvdXRwdXRzIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGlyZWN0aXZlUmVmPFQ+IHtcbiAgaW5zdGFuY2U6IFQ7XG4gIHR5cGU6IFR5cGU8VD47XG4gIGluamVjdG9yOiBJbmplY3RvcjtcbiAgaG9zdENvbXBvbmVudDogVHlwZTxhbnk+O1xuICBob3N0VmlldzogVmlld1JlZjtcbiAgbG9jYXRpb246IEVsZW1lbnRSZWY7XG4gIGNoYW5nZURldGVjdG9yUmVmOiBDaGFuZ2VEZXRlY3RvclJlZjtcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBiYW4tdHlwZXNcbiAgb25EZXN0cm95OiAoY2FsbGJhY2s6IEZ1bmN0aW9uKSA9PiB2b2lkO1xufVxuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbbmRjRHluYW1pY0RpcmVjdGl2ZXNdLFtuZ0NvbXBvbmVudE91dGxldE5kY0R5bmFtaWNEaXJlY3RpdmVzXScsXG59KVxuZXhwb3J0IGNsYXNzIER5bmFtaWNEaXJlY3RpdmVzRGlyZWN0aXZlIGltcGxlbWVudHMgT25EZXN0cm95LCBEb0NoZWNrIHtcbiAgQElucHV0KClcbiAgbmRjRHluYW1pY0RpcmVjdGl2ZXM6IER5bmFtaWNEaXJlY3RpdmVEZWY8YW55PltdO1xuICBASW5wdXQoKVxuICBuZ0NvbXBvbmVudE91dGxldE5kY0R5bmFtaWNEaXJlY3RpdmVzOiBEeW5hbWljRGlyZWN0aXZlRGVmPGFueT5bXTtcblxuICBAT3V0cHV0KClcbiAgbmRjRHluYW1pY0RpcmVjdGl2ZXNDcmVhdGVkID0gbmV3IEV2ZW50RW1pdHRlcjxEaXJlY3RpdmVSZWY8YW55PltdPigpO1xuXG4gIHByaXZhdGUgbGFzdENvbXBJbnN0YW5jZTogYW55O1xuXG4gIHByaXZhdGUgZ2V0IGRpcmVjdGl2ZXMoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIHRoaXMubmRjRHluYW1pY0RpcmVjdGl2ZXMgfHwgdGhpcy5uZ0NvbXBvbmVudE91dGxldE5kY0R5bmFtaWNEaXJlY3RpdmVzXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IGNvbXBvbmVudFJlZigpIHtcbiAgICByZXR1cm4gdGhpcy5jb21wb25lbnRJbmplY3Rvci5jb21wb25lbnRSZWY7XG4gIH1cblxuICBwcml2YXRlIGdldCBjb21wSW5zdGFuY2UoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29tcG9uZW50UmVmICYmIHRoaXMuY29tcG9uZW50UmVmLmluc3RhbmNlO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgaXNDb21wQ2hhbmdlZCgpIHtcbiAgICBpZiAodGhpcy5sYXN0Q29tcEluc3RhbmNlICE9PSB0aGlzLmNvbXBJbnN0YW5jZSkge1xuICAgICAgdGhpcy5sYXN0Q29tcEluc3RhbmNlID0gdGhpcy5jb21wSW5zdGFuY2U7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgaG9zdEluamVjdG9yKCkge1xuICAgIHJldHVybiB0aGlzLmNvbXBvbmVudFJlZi5pbmplY3RvcjtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IGhvc3RWY3IoKTogVmlld0NvbnRhaW5lclJlZiB7XG4gICAgLy8gTk9URTogQWNjZXNzaW5nIHByaXZhdGUgQVBJcyBvZiBBbmd1bGFyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby1zdHJpbmctbGl0ZXJhbFxuICAgIHJldHVybiB0aGlzLmNvbXBvbmVudFJlZlsnX3ZpZXdSZWYnXVsnX3ZpZXdDb250YWluZXJSZWYnXTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IHJlZmxlY3QoKSB7XG4gICAgcmV0dXJuICh0aGlzLndpbmRvd1JlZi5uYXRpdmVXaW5kb3cgYXMgYW55KS5SZWZsZWN0O1xuICB9XG5cbiAgcHJpdmF0ZSBkaXJSZWYgPSBuZXcgTWFwPFR5cGU8YW55PiwgRGlyZWN0aXZlUmVmPGFueT4+KCk7XG4gIHByaXZhdGUgZGlySW8gPSBuZXcgTWFwPFR5cGU8YW55PiwgSW9TZXJ2aWNlPigpO1xuICBwcml2YXRlIGRpcnNEaWZmZXIgPSB0aGlzLml0ZXJhYmxlRGlmZmVyc1xuICAgIC5maW5kKFtdKVxuICAgIC5jcmVhdGU8RHluYW1pY0RpcmVjdGl2ZURlZjxhbnk+PigoXywgZGVmKSA9PiBkZWYudHlwZSk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBpdGVyYWJsZURpZmZlcnM6IEl0ZXJhYmxlRGlmZmVycyxcbiAgICBwcml2YXRlIGlvRmFjdG9yeVNlcnZpY2U6IElvRmFjdG9yeVNlcnZpY2UsXG4gICAgcHJpdmF0ZSB3aW5kb3dSZWY6IFdpbmRvd1JlZlNlcnZpY2UsXG4gICAgQEluamVjdChEeW5hbWljQ29tcG9uZW50SW5qZWN0b3JUb2tlbilcbiAgICBAT3B0aW9uYWwoKVxuICAgIHByaXZhdGUgY29tcG9uZW50SW5qZWN0b3I/OiBEeW5hbWljQ29tcG9uZW50SW5qZWN0b3IsXG4gICkge31cblxuICBuZ0RvQ2hlY2soKTogdm9pZCB7XG4gICAgaWYgKHRoaXMubWF5YmVEZXN0cm95RGlyZWN0aXZlcygpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgZGlyc0NoYW5nZXMgPSB0aGlzLmRpcnNEaWZmZXIuZGlmZih0aGlzLmRpcmVjdGl2ZXMpO1xuXG4gICAgaWYgKCFkaXJzQ2hhbmdlcykge1xuICAgICAgcmV0dXJuIHRoaXMudXBkYXRlRGlyZWN0aXZlcygpO1xuICAgIH1cblxuICAgIHRoaXMucHJvY2Vzc0RpckNoYW5nZXMoZGlyc0NoYW5nZXMpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5kZXN0cm95QWxsRGlyZWN0aXZlcygpO1xuICB9XG5cbiAgcHJpdmF0ZSBtYXliZURlc3Ryb3lEaXJlY3RpdmVzKCkge1xuICAgIGlmICh0aGlzLmlzQ29tcENoYW5nZWQgfHwgIXRoaXMuY29tcG9uZW50UmVmKSB7XG4gICAgICB0aGlzLmRpcnNEaWZmZXIuZGlmZihbXSk7XG4gICAgICB0aGlzLmRlc3Ryb3lBbGxEaXJlY3RpdmVzKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuICF0aGlzLmNvbXBvbmVudFJlZjtcbiAgfVxuXG4gIHByaXZhdGUgcHJvY2Vzc0RpckNoYW5nZXMoXG4gICAgY2hhbmdlczogSXRlcmFibGVDaGFuZ2VzPER5bmFtaWNEaXJlY3RpdmVEZWY8YW55Pj4sXG4gICkge1xuICAgIGNoYW5nZXMuZm9yRWFjaFJlbW92ZWRJdGVtKCh7IGl0ZW0gfSkgPT4gdGhpcy5kZXN0cm95RGlyZWN0aXZlKGl0ZW0pKTtcblxuICAgIGNvbnN0IGNyZWF0ZWREaXJzID0gW107XG4gICAgY2hhbmdlcy5mb3JFYWNoQWRkZWRJdGVtKCh7IGl0ZW0gfSkgPT5cbiAgICAgIGNyZWF0ZWREaXJzLnB1c2godGhpcy5pbml0RGlyZWN0aXZlKGl0ZW0pKSxcbiAgICApO1xuXG4gICAgaWYgKGNyZWF0ZWREaXJzLmxlbmd0aCkge1xuICAgICAgdGhpcy5uZGNEeW5hbWljRGlyZWN0aXZlc0NyZWF0ZWQuZW1pdChjcmVhdGVkRGlycy5maWx0ZXIoQm9vbGVhbikpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlRGlyZWN0aXZlcygpIHtcbiAgICB0aGlzLmRpcmVjdGl2ZXMuZm9yRWFjaChkaXIgPT4gdGhpcy51cGRhdGVEaXJlY3RpdmUoZGlyKSk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZURpcmVjdGl2ZShkaXJEZWY6IER5bmFtaWNEaXJlY3RpdmVEZWY8YW55Pikge1xuICAgIGNvbnN0IGlvID0gdGhpcy5kaXJJby5nZXQoZGlyRGVmLnR5cGUpO1xuICAgIGlvLnVwZGF0ZShkaXJEZWYuaW5wdXRzLCBkaXJEZWYub3V0cHV0cywgZmFsc2UsIGZhbHNlKTtcbiAgICBpby5tYXliZVVwZGF0ZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0RGlyZWN0aXZlKFxuICAgIGRpckRlZjogRHluYW1pY0RpcmVjdGl2ZURlZjxhbnk+LFxuICApOiBEaXJlY3RpdmVSZWY8YW55PiB8IHVuZGVmaW5lZCB7XG4gICAgaWYgKHRoaXMuZGlyUmVmLmhhcyhkaXJEZWYudHlwZSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMuY3JlYXRlRGlyZWN0aXZlKGRpckRlZi50eXBlKTtcbiAgICBjb25zdCBkaXIgPSB7XG4gICAgICBpbnN0YW5jZSxcbiAgICAgIHR5cGU6IGRpckRlZi50eXBlLFxuICAgICAgaW5qZWN0b3I6IHRoaXMuaG9zdEluamVjdG9yLFxuICAgICAgaG9zdENvbXBvbmVudDogdGhpcy5jb21wb25lbnRSZWYuaW5zdGFuY2UsXG4gICAgICBob3N0VmlldzogdGhpcy5jb21wb25lbnRSZWYuaG9zdFZpZXcsXG4gICAgICBsb2NhdGlvbjogdGhpcy5jb21wb25lbnRSZWYubG9jYXRpb24sXG4gICAgICBjaGFuZ2VEZXRlY3RvclJlZjogdGhpcy5jb21wb25lbnRSZWYuY2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgICBvbkRlc3Ryb3k6IHRoaXMuY29tcG9uZW50UmVmLm9uRGVzdHJveSxcbiAgICB9O1xuXG4gICAgdGhpcy5pbml0RGlySU8oZGlyLCBkaXJEZWYuaW5wdXRzLCBkaXJEZWYub3V0cHV0cyk7XG4gICAgdGhpcy5jYWxsSW5pdEhvb2tzKGluc3RhbmNlKTtcblxuICAgIHRoaXMuZGlyUmVmLnNldChkaXIudHlwZSwgZGlyKTtcblxuICAgIHJldHVybiBkaXI7XG4gIH1cblxuICBwcml2YXRlIGRlc3Ryb3lBbGxEaXJlY3RpdmVzKCkge1xuICAgIHRoaXMuZGlyUmVmLmZvckVhY2goZGlyID0+IHRoaXMuZGVzdHJveURpclJlZihkaXIpKTtcbiAgICB0aGlzLmRpclJlZi5jbGVhcigpO1xuICAgIHRoaXMuZGlySW8uY2xlYXIoKTtcbiAgfVxuXG4gIHByaXZhdGUgZGVzdHJveURpcmVjdGl2ZShkaXJEZWY6IER5bmFtaWNEaXJlY3RpdmVEZWY8YW55Pikge1xuICAgIHRoaXMuZGVzdHJveURpclJlZih0aGlzLmRpclJlZi5nZXQoZGlyRGVmLnR5cGUpKTtcbiAgICB0aGlzLmRpclJlZi5kZWxldGUoZGlyRGVmLnR5cGUpO1xuICAgIHRoaXMuZGlySW8uZGVsZXRlKGRpckRlZi50eXBlKTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdERpcklPKGRpcjogRGlyZWN0aXZlUmVmPGFueT4sIGlucHV0cz86IGFueSwgb3V0cHV0cz86IGFueSkge1xuICAgIGNvbnN0IGlvID0gdGhpcy5pb0ZhY3RvcnlTZXJ2aWNlLmNyZWF0ZSgpO1xuICAgIGlvLmluaXQoXG4gICAgICB7IGNvbXBvbmVudFJlZjogdGhpcy5kaXJUb0NvbXBEZWYoZGlyKSB9LFxuICAgICAgeyB0cmFja091dHB1dENoYW5nZXM6IHRydWUgfSxcbiAgICApO1xuICAgIGlvLnVwZGF0ZShpbnB1dHMsIG91dHB1dHMsICEhaW5wdXRzLCAhIW91dHB1dHMpO1xuICAgIHRoaXMuZGlySW8uc2V0KGRpci50eXBlLCBpbyk7XG4gIH1cblxuICBwcml2YXRlIGRpclRvQ29tcERlZihkaXI6IERpcmVjdGl2ZVJlZjxhbnk+KTogQ29tcG9uZW50UmVmPGFueT4ge1xuICAgIHJldHVybiB7XG4gICAgICBjaGFuZ2VEZXRlY3RvclJlZjogdGhpcy5jb21wb25lbnRSZWYuY2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgICBob3N0VmlldzogdGhpcy5jb21wb25lbnRSZWYuaG9zdFZpZXcsXG4gICAgICBsb2NhdGlvbjogdGhpcy5jb21wb25lbnRSZWYubG9jYXRpb24sXG4gICAgICBkZXN0cm95OiB0aGlzLmNvbXBvbmVudFJlZi5kZXN0cm95LFxuICAgICAgb25EZXN0cm95OiB0aGlzLmNvbXBvbmVudFJlZi5vbkRlc3Ryb3ksXG4gICAgICBpbmplY3RvcjogdGhpcy5jb21wb25lbnRSZWYuaW5qZWN0b3IsXG4gICAgICBpbnN0YW5jZTogZGlyLmluc3RhbmNlLFxuICAgICAgY29tcG9uZW50VHlwZTogZGlyLnR5cGUsXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZGVzdHJveURpclJlZihkaXI6IERpcmVjdGl2ZVJlZjxhbnk+KSB7XG4gICAgY29uc3QgaW8gPSB0aGlzLmRpcklvLmdldChkaXIudHlwZSk7XG4gICAgaW8ubmdPbkRlc3Ryb3koKTtcblxuICAgIGlmICgnbmdPbkRlc3Ryb3knIGluIGRpci5pbnN0YW5jZSkge1xuICAgICAgZGlyLmluc3RhbmNlLm5nT25EZXN0cm95KCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVEaXJlY3RpdmU8VD4oZGlyVHlwZTogVHlwZTxUPik6IFQge1xuICAgIGNvbnN0IGRpcmVjdGl2ZUluamVjdG9yID0gSW5qZWN0b3IuY3JlYXRlKHtcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogZGlyVHlwZSxcbiAgICAgICAgICB1c2VDbGFzczogZGlyVHlwZSxcbiAgICAgICAgICBkZXBzOiB0aGlzLnJlc29sdmVEaXJQYXJhbVR5cGVzKGRpclR5cGUpLFxuICAgICAgICB9LFxuICAgICAgICB7IHByb3ZpZGU6IEVsZW1lbnRSZWYsIHVzZVZhbHVlOiB0aGlzLmNvbXBvbmVudFJlZi5sb2NhdGlvbiB9LFxuICAgICAgXSxcbiAgICAgIHBhcmVudDogdGhpcy5ob3N0SW5qZWN0b3IsXG4gICAgICBuYW1lOiBgRHluYW1pY0RpcmVjdGl2ZUluamVjdG9yOiR7ZGlyVHlwZS5uYW1lfUAke3RoaXMuY29tcG9uZW50UmVmLmNvbXBvbmVudFR5cGUubmFtZX1gLFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGRpcmVjdGl2ZUluamVjdG9yLmdldChkaXJUeXBlKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVzb2x2ZURpclBhcmFtVHlwZXMoZGlyVHlwZTogVHlwZTxhbnk+KTogYW55W10ge1xuICAgIHJldHVybiAoXG4gICAgICAvLyBGaXJzdCB0cnkgQW5ndWxhciBDb21waWxlcidzIG1ldGFkYXRhXG4gICAgICBleHRyYWN0TmdQYXJhbVR5cGVzKGRpclR5cGUpID8/XG4gICAgICAvLyBUaGVuIGZhbGxiYWNrIHRvIFR5cGVzY3JpcHQgUmVmbGVjdCBBUElcbiAgICAgIGdldEN0b3JQYXJhbVR5cGVzKGRpclR5cGUsIHRoaXMucmVmbGVjdCkgPz9cbiAgICAgIC8vIEJhaWxvdXRcbiAgICAgIFtdXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsbEluaXRIb29rcyhvYmo6IGFueSkge1xuICAgIHRoaXMuY2FsbEhvb2sob2JqLCAnbmdPbkluaXQnKTtcbiAgICB0aGlzLmNhbGxIb29rKG9iaiwgJ25nRG9DaGVjaycpO1xuICAgIHRoaXMuY2FsbEhvb2sob2JqLCAnbmdBZnRlckNvbnRlbnRJbml0Jyk7XG4gICAgdGhpcy5jYWxsSG9vayhvYmosICduZ0FmdGVyQ29udGVudENoZWNrZWQnKTtcbiAgICB0aGlzLmNhbGxIb29rKG9iaiwgJ25nQWZ0ZXJWaWV3SW5pdCcpO1xuICAgIHRoaXMuY2FsbEhvb2sob2JqLCAnbmdBZnRlclZpZXdDaGVja2VkJyk7XG4gIH1cblxuICBwcml2YXRlIGNhbGxIb29rKG9iajogYW55LCBob29rOiBzdHJpbmcsIGFyZ3M6IGFueVtdID0gW10pIHtcbiAgICBpZiAob2JqW2hvb2tdKSB7XG4gICAgICBvYmpbaG9va10oLi4uYXJncyk7XG4gICAgfVxuICB9XG59XG4iXX0=