!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ng-dynamic-component",["exports","@angular/core","@angular/common","rxjs","rxjs/operators"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["ng-dynamic-component"]={},t.ng.core,t.ng.common,t.rxjs,t.rxjs.operators)}(this,(function(t,e,n,o,r){"use strict";function i(){return"$event"}var c=new e.InjectionToken("EventArgument",{providedIn:"root",factory:i});var s=new e.InjectionToken("DynamicComponentInjector"),p=s,u=function(){function t(t){this.componentOutlet=t}return Object.defineProperty(t.prototype,"componentRef",{get:function(){return this.componentOutlet._componentRef},enumerable:!1,configurable:!0}),t}();u.decorators=[{type:e.Directive,args:[{selector:"[ngComponentOutlet]",exportAs:"ndcComponentOutletInjector",providers:[{provide:s,useExisting:u}]}]}],u.ctorParameters=function(){return[{type:n.NgComponentOutlet,decorators:[{type:e.Host}]}]};var a=function(){};a.decorators=[{type:e.NgModule,args:[{imports:[n.CommonModule],exports:[u],declarations:[u]}]}];Object.create;function f(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],o=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function h(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,r,i=n.call(t),c=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)c.push(o.value)}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return c}function y(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(h(arguments[e]));return t}Object.create;function m(t){return new e.SimpleChange(void 0,t,!0)}function d(){}var l=function(){function t(t,e,n){this.differs=t,this.cfr=e,this.eventArgument=n,this.checkInit=this.failInit,this.lastComponentInst=null,this.inputsDiffer=this.differs.find({}).create(),this.compFactory=null,this.outputsShouldDisconnect$=new o.Subject,this.outputsChanged=function(){return!1}}return Object.defineProperty(t.prototype,"compRef",{get:function(){return this.compInjector.componentRef},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"componentInst",{get:function(){return this.compRef?this.compRef.instance:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"componentInstChanged",{get:function(){return this.lastComponentInst!==this.componentInst&&(this.lastComponentInst=this.componentInst,!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"compCdr",{get:function(){return this.compRef?this.compRef.injector.get(e.ChangeDetectorRef):null},enumerable:!1,configurable:!0}),t.prototype.ngOnDestroy=function(){this._disconnectOutputs()},t.prototype.init=function(t,e){if(void 0===e&&(e={}),this.checkInit=t?d:this.failInit,this.compInjector=t,e.trackOutputChanges){var n=this.differs.find({}).create();this.outputsChanged=function(t){return!!n.diff(t)}}},t.prototype.update=function(t,e,n,o){this.checkInit(),this.updateIO(t,e);var r=this.componentInstChanged;if(r||n){var i=this._getInputsChanges();i&&this._updateInputChanges(i),this.updateInputs(r||!this.lastInputChanges)}(r||o)&&this.bindOutputs()},t.prototype.maybeUpdate=function(){if(this.checkInit(),this.componentInstChanged)return this.updateInputs(!0),void this.bindOutputs();if(this.outputsChanged(this.outputs)&&this.bindOutputs(),this.inputs){var t=this._getInputsChanges();if(t){var e=!!this.lastInputChanges;this._updateInputChanges(t),e&&this.updateInputs()}}},t.prototype.updateIO=function(t,e){this.inputs=t,this.outputs=e},t.prototype.updateInputs=function(t){void 0===t&&(t=!1),t&&this._updateCompFactory();var e=this.componentInst,n=this.inputs;n&&e&&(n=this._resolveInputs(n),Object.keys(n).forEach((function(t){return e[t]=n[t]})),this.compCdr&&this.compCdr.markForCheck(),this.notifyOnInputChanges(this.lastInputChanges,t))},t.prototype.bindOutputs=function(){var t=this;this._disconnectOutputs();var e=this.componentInst,n=this.outputs;n&&e&&(n=this._resolveOutputs(n),Object.keys(n).filter((function(t){return e[t]})).forEach((function(o){return e[o].pipe(r.takeUntil(t.outputsShouldDisconnect$)).subscribe((function(t){return n[o](t)}))})))},t.prototype.notifyOnInputChanges=function(t,e){void 0===t&&(t={}),this.componentInst.ngOnChanges&&(e&&(t=this._collectFirstChanges()),this.componentInst.ngOnChanges(t))},t.prototype._disconnectOutputs=function(){this.outputsShouldDisconnect$.next()},t.prototype._getInputsChanges=function(){return this.inputsDiffer.diff(this.inputs)},t.prototype._updateInputChanges=function(t){this.lastInputChanges=this._collectChangesFromDiffer(t)},t.prototype._collectFirstChanges=function(){var t={},e=this.inputs;return Object.keys(e).forEach((function(n){return t[n]=m(e[n])})),this._resolveChanges(t)},t.prototype._collectChangesFromDiffer=function(t){var n={};return t.forEachAddedItem((function(t){return n[t.key]=m(t.currentValue)})),t.forEachChangedItem((function(t){return n[t.key]=(o=t.currentValue,r=t.previousValue,new e.SimpleChange(r,o,!1));var o,r})),this._resolveChanges(n)},t.prototype._resolveCompFactory=function(){try{try{return this.cfr.resolveComponentFactory(this.compRef.componentType)}catch(t){return this.cfr.resolveComponentFactory(this.compRef.instance.constructor)}}catch(t){return null}},t.prototype._updateCompFactory=function(){this.compFactory=this._resolveCompFactory()},t.prototype._resolveInputs=function(t){return this.compFactory?this._remapIO(t,this.compFactory.inputs):t},t.prototype._resolveOutputs=function(t){return t=this._processOutputs(t),this.compFactory?this._remapIO(t,this.compFactory.outputs):t},t.prototype._processOutputs=function(t){var e=this,n={};return Object.keys(t).forEach((function(o){var r=t[o];n[o]="function"==typeof r?r:r&&e._processOutputArgs(r)})),n},t.prototype._processOutputArgs=function(t){var e=this,n=t.handler,o="args"in t?t.args||[]:[this.eventArgument];return function(t){return n.apply(void 0,y(o.map((function(n){return n===e.eventArgument?t:n}))))}},t.prototype._resolveChanges=function(t){return this.compFactory?this._remapIO(t,this.compFactory.inputs):t},t.prototype._remapIO=function(t,e){var n=this,o={};return Object.keys(t).forEach((function(r){var i=n._findPropByTplInMapping(r,e)||r;o[i]=t[r]})),o},t.prototype._findPropByTplInMapping=function(t,e){var n,o;try{for(var r=f(e),i=r.next();!i.done;i=r.next()){var c=i.value;if(c.templateName===t)return c.propName}}catch(t){n={error:t}}finally{try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(n)throw n.error}}return null},t.prototype.failInit=function(){throw Error("IoService: ComponentInjector was not set! Please call init() method!")},t}();l.decorators=[{type:e.Injectable}],l.ctorParameters=function(){return[{type:e.KeyValueDiffers},{type:e.ComponentFactoryResolver},{type:String,decorators:[{type:e.Inject,args:[c]}]}]};var v=function(){function t(t,e){this.ioService=t,this.componentInjector=e,this.ioService.init(this.componentInjector)}return Object.defineProperty(t.prototype,"inputs",{get:function(){return this.ndcDynamicInputs||this.ngComponentOutletNdcDynamicInputs},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"outputs",{get:function(){return this.ndcDynamicOutputs||this.ngComponentOutletNdcDynamicOutputs},enumerable:!1,configurable:!0}),t.prototype.ngOnChanges=function(t){this.ioService.update(this.inputs,this.outputs,this.inputsChanged(t),this.outputsChanged(t))},t.prototype.ngDoCheck=function(){this.ioService.maybeUpdate()},t.prototype.inputsChanged=function(t){return"ngComponentOutletNdcDynamicInputs"in t||"ndcDynamicInputs"in t},t.prototype.outputsChanged=function(t){return"ngComponentOutletNdcDynamicOutputs"in t||"ndcDynamicOutputs"in t},t}();v.decorators=[{type:e.Directive,args:[{selector:"[ndcDynamicInputs],[ndcDynamicOutputs],[ngComponentOutletNdcDynamicInputs],[ngComponentOutletNdcDynamicOutputs]",providers:[l]}]}],v.ctorParameters=function(){return[{type:l},{type:void 0,decorators:[{type:e.Inject,args:[s]},{type:e.Optional}]}]},v.propDecorators={ndcDynamicInputs:[{type:e.Input}],ngComponentOutletNdcDynamicInputs:[{type:e.Input}],ndcDynamicOutputs:[{type:e.Input}],ngComponentOutletNdcDynamicOutputs:[{type:e.Input}]};var g=function(){};g.decorators=[{type:e.NgModule,args:[{imports:[n.CommonModule],exports:[v,a],declarations:[v]}]}];var D=function(){function t(t,n){this.vcr=t,this.cfr=n,this.ndcDynamicCreated=new e.EventEmitter}return t.prototype.ngOnChanges=function(t){t.ndcDynamicComponent&&this.createDynamicComponent()},t.prototype.createDynamicComponent=function(){this.vcr.clear(),this.componentRef=null,this.ndcDynamicComponent&&(this.componentRef=this.vcr.createComponent(this.cfr.resolveComponentFactory(this.ndcDynamicComponent),0,this._resolveInjector(),this.ndcDynamicContent),this.ndcDynamicCreated.emit(this.componentRef))},t.prototype._resolveInjector=function(){var t=this.ndcDynamicInjector||this.vcr.injector;return this.ndcDynamicProviders&&(t=e.Injector.create({providers:this.ndcDynamicProviders,parent:t})),t},t}();D.decorators=[{type:e.Component,args:[{selector:"ndc-dynamic",template:"",providers:[{provide:s,useExisting:D}]}]}],D.ctorParameters=function(){return[{type:e.ViewContainerRef},{type:e.ComponentFactoryResolver}]},D.propDecorators={ndcDynamicComponent:[{type:e.Input}],ndcDynamicInjector:[{type:e.Input}],ndcDynamicProviders:[{type:e.Input}],ndcDynamicContent:[{type:e.Input}],ndcDynamicCreated:[{type:e.Output}]};var I=function(){};I.decorators=[{type:e.NgModule,args:[{imports:[n.CommonModule,g],exports:[D,g],declarations:[D]}]}];var C=function(){function t(t,e,n,o){this.renderer=t,this.differs=e,this.injector=n,this.componentInjector=o,this.attrsDiffer=this.differs.find({}).create()}return Object.defineProperty(t.prototype,"_attributes",{get:function(){return this.ndcDynamicAttributes||this.ngComponentOutletNdcDynamicAttributes},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_nativeElement",{get:function(){var t;return null===(t=this.componentInjector.componentRef)||void 0===t?void 0:t.location.nativeElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_compType",{get:function(){var t;return null===(t=this.componentInjector.componentRef)||void 0===t?void 0:t.componentType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_isCompChanged",{get:function(){return this.lastCompType!==this._compType&&(this.lastCompType=this._compType,!0)},enumerable:!1,configurable:!0}),t.prototype.ngDoCheck=function(){var t=this._isCompChanged,e=this.attrsDiffer.diff(this._attributes);e&&(this.lastAttrActions=this._changesToAttrActions(e)),(e||t&&this.lastAttrActions)&&this._updateAttributes(this.lastAttrActions)},t.prototype.setAttribute=function(t,e,n){this._nativeElement&&this.renderer.setAttribute(this._nativeElement,t,e,n)},t.prototype.removeAttribute=function(t,e){this._nativeElement&&this.renderer.removeAttribute(this._nativeElement,t,e)},t.prototype._updateAttributes=function(t){var e=this;this._compType&&(Object.keys(t.set).forEach((function(n){return e.setAttribute(n,t.set[n])})),t.remove.forEach((function(t){return e.removeAttribute(t)})))},t.prototype._changesToAttrActions=function(t){var e={set:{},remove:[]};return t.forEachAddedItem((function(t){return e.set[t.key]=t.currentValue})),t.forEachChangedItem((function(t){return e.set[t.key]=t.currentValue})),t.forEachRemovedItem((function(t){return e.remove.push(t.key)})),e},t}();C.decorators=[{type:e.Directive,args:[{selector:"[ndcDynamicAttributes],[ngComponentOutletNdcDynamicAttributes]",exportAs:"ndcDynamicAttributes"}]}],C.ctorParameters=function(){return[{type:e.Renderer2},{type:e.KeyValueDiffers},{type:e.Injector},{type:void 0,decorators:[{type:e.Inject,args:[s]},{type:e.Optional}]}]},C.propDecorators={ndcDynamicAttributes:[{type:e.Input}],ngComponentOutletNdcDynamicAttributes:[{type:e.Input}]};var b=function(){};b.decorators=[{type:e.NgModule,args:[{imports:[n.CommonModule],exports:[C,a],declarations:[C]}]}];var O=function(){function t(t,e,n){this.differs=t,this.cfr=e,this.eventArgument=n}return t.prototype.create=function(){return new l(this.differs,this.cfr,this.eventArgument)},t}();O.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],O.ctorParameters=function(){return[{type:e.KeyValueDiffers},{type:e.ComponentFactoryResolver},{type:String,decorators:[{type:e.Inject,args:[c]}]}]},O.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new O(e.ɵɵinject(e.KeyValueDiffers),e.ɵɵinject(e.ComponentFactoryResolver),e.ɵɵinject(c))},token:O,providedIn:"root"});var j=new e.InjectionToken("WindowRef",{providedIn:"root",factory:function(){return window}}),R=function(t){this.injector=t,this.nativeWindow=this.injector.get(j,null)};R.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],R.ctorParameters=function(){return[{type:e.Injector}]},R.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new R(e.ɵɵinject(e.INJECTOR))},token:R,providedIn:"root"});var _=function(){function t(t,n,o,r){this.iterableDiffers=t,this.ioFactoryService=n,this.windowRef=o,this.componentInjector=r,this.ndcDynamicDirectivesCreated=new e.EventEmitter,this.dirRef=new Map,this.dirIo=new Map,this.dirsDiffer=this.iterableDiffers.find([]).create((function(t,e){return e.type}))}return Object.defineProperty(t.prototype,"directives",{get:function(){return this.ndcDynamicDirectives||this.ngComponentOutletNdcDynamicDirectives},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"componentRef",{get:function(){return this.componentInjector.componentRef},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"compInstance",{get:function(){return this.componentRef&&this.componentRef.instance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCompChanged",{get:function(){return this.lastCompInstance!==this.compInstance&&(this.lastCompInstance=this.compInstance,!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hostInjector",{get:function(){return this.componentRef.injector},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hostVcr",{get:function(){return this.componentRef._viewRef._viewContainerRef},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflect",{get:function(){return this.windowRef.nativeWindow.Reflect},enumerable:!1,configurable:!0}),t.prototype.ngDoCheck=function(){if(!this.maybeDestroyDirectives()){var t=this.dirsDiffer.diff(this.directives);if(!t)return this.updateDirectives();this.processDirChanges(t)}},t.prototype.ngOnDestroy=function(){this.destroyAllDirectives()},t.prototype.maybeDestroyDirectives=function(){return!this.isCompChanged&&this.componentRef||(this.dirsDiffer.diff([]),this.destroyAllDirectives()),!this.componentRef},t.prototype.processDirChanges=function(t){var e=this;t.forEachRemovedItem((function(t){var n=t.item;return e.destroyDirective(n)}));var n=[];t.forEachAddedItem((function(t){var o=t.item;return n.push(e.initDirective(o))})),n.length&&this.ndcDynamicDirectivesCreated.emit(n.filter(Boolean))},t.prototype.updateDirectives=function(){var t=this;this.directives.forEach((function(e){return t.updateDirective(e)}))},t.prototype.updateDirective=function(t){var e=this.dirIo.get(t.type);e.update(t.inputs,t.outputs,!1,!1),e.maybeUpdate()},t.prototype.initDirective=function(t){if(!this.dirRef.has(t.type)){var e=this.createDirective(t.type),n={instance:e,type:t.type,injector:this.hostInjector,hostComponent:this.componentRef.instance,hostView:this.componentRef.hostView,location:this.componentRef.location,changeDetectorRef:this.componentRef.changeDetectorRef,onDestroy:this.componentRef.onDestroy};return this.initDirIO(n,t.inputs,t.outputs),this.callInitHooks(e),this.dirRef.set(n.type,n),n}},t.prototype.destroyAllDirectives=function(){var t=this;this.dirRef.forEach((function(e){return t.destroyDirRef(e)})),this.dirRef.clear(),this.dirIo.clear()},t.prototype.destroyDirective=function(t){this.destroyDirRef(this.dirRef.get(t.type)),this.dirRef.delete(t.type),this.dirIo.delete(t.type)},t.prototype.initDirIO=function(t,e,n){var o=this.ioFactoryService.create();o.init({componentRef:this.dirToCompDef(t)},{trackOutputChanges:!0}),o.update(e,n,!!e,!!n),this.dirIo.set(t.type,o)},t.prototype.dirToCompDef=function(t){return{changeDetectorRef:this.componentRef.changeDetectorRef,hostView:this.componentRef.hostView,location:this.componentRef.location,destroy:this.componentRef.destroy,onDestroy:this.componentRef.onDestroy,injector:this.componentRef.injector,instance:t.instance,componentType:t.type}},t.prototype.destroyDirRef=function(t){this.dirIo.get(t.type).ngOnDestroy(),"ngOnDestroy"in t.instance&&t.instance.ngOnDestroy()},t.prototype.createDirective=function(t){return e.Injector.create({providers:[{provide:t,useClass:t,deps:this.resolveDirParamTypes(t)},{provide:e.ElementRef,useValue:this.componentRef.location}],parent:this.hostInjector,name:"DynamicDirectiveInjector:"+t.name+"@"+this.componentRef.componentType.name}).get(t)},t.prototype.resolveDirParamTypes=function(t){var e,n,o;return null!==(n=null!==(e=function(t){var e,n,o;return null===(o=null===(n=null===(e=t)||void 0===e?void 0:e.ctorParameters)||void 0===n?void 0:n.call(e))||void 0===o?void 0:o.map((function(t){return t.type}))}(t))&&void 0!==e?e:(o=t,this.reflect.getMetadata("design:paramtypes",o)))&&void 0!==n?n:[]},t.prototype.callInitHooks=function(t){this.callHook(t,"ngOnInit"),this.callHook(t,"ngDoCheck"),this.callHook(t,"ngAfterContentInit"),this.callHook(t,"ngAfterContentChecked"),this.callHook(t,"ngAfterViewInit"),this.callHook(t,"ngAfterViewChecked")},t.prototype.callHook=function(t,e,n){void 0===n&&(n=[]),t[e]&&t[e].apply(t,y(n))},t}();_.decorators=[{type:e.Directive,args:[{selector:"[ndcDynamicDirectives],[ngComponentOutletNdcDynamicDirectives]"}]}],_.ctorParameters=function(){return[{type:e.IterableDiffers},{type:O},{type:R},{type:void 0,decorators:[{type:e.Inject,args:[s]},{type:e.Optional}]}]},_.propDecorators={ndcDynamicDirectives:[{type:e.Input}],ngComponentOutletNdcDynamicDirectives:[{type:e.Input}],ndcDynamicDirectivesCreated:[{type:e.Output}]};var A=function(){};A.decorators=[{type:e.NgModule,args:[{imports:[n.CommonModule],exports:[_,a],declarations:[_]}]}],t.COMPONENT_INJECTOR=p,t.ComponentOutletInjectorDirective=u,t.ComponentOutletInjectorModule=a,t.DynamicAttributesDirective=C,t.DynamicAttributesModule=b,t.DynamicComponent=D,t.DynamicComponentInjectorToken=s,t.DynamicDirectivesDirective=_,t.DynamicDirectivesModule=A,t.DynamicIoDirective=v,t.DynamicIoModule=g,t.DynamicModule=I,t.EventArgumentToken=c,t.defaultEventArgumentFactory=i,t.dynamicDirectiveDef=function(t,e,n){return{type:t,inputs:e,outputs:n}},t.ɵa=l,t.ɵb=s,t.ɵc=O,t.ɵd=R,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ng-dynamic-component.umd.min.js.map